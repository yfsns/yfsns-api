<?php

/**
 * 限流配置
 * 
 * 配置API限流规则，包括IP白名单、不同类型请求的限制等
 */

return [

    /*
    |--------------------------------------------------------------------------
    | IP白名单
    |--------------------------------------------------------------------------
    |
    | 白名单中的IP地址不会受到限流限制
    | 适用于内部服务、监控系统等
    |
    */
    'whitelist' => [
        '127.0.0.1',      // 本地开发
        '::1',            // IPv6本地
        '10.0.0.0/8',     // 私有网络
        '172.16.0.0/12',  // 私有网络
        '192.168.0.0/16', // 私有网络
    ],

    /*
    |--------------------------------------------------------------------------
    | 跳过限流的路径
    |--------------------------------------------------------------------------
    |
    | 这些路径不会进行限流检查
    | 适用于健康检查、静态资源等低风险请求
    |
    */
    'skip_paths' => [
        'health',
        'ping', 
        '_debugbar',
        'favicon.ico',
        'robots.txt',
        'sitemap.xml',
    ],

    /*
    |--------------------------------------------------------------------------
    | 限流规则配置
    |--------------------------------------------------------------------------
    |
    | 为不同类型的请求设置不同的限流规则
    |
    */
    'limits' => [

        // 默认规则
        'default' => [
            'max_attempts' => 1000,  // 每分钟最多1000次
            'decay_seconds' => 60,   // 60秒重置
        ],

        // API GET请求
        'api_read' => [
            'max_attempts' => 500,   // 每分钟500次
            'decay_seconds' => 60,
        ],

        // API写操作 (POST/PUT/DELETE)
        'api_write' => [
            'max_attempts' => 200,   // 每分钟200次
            'decay_seconds' => 60,
        ],

        // 管理后台
        'admin' => [
            'max_attempts' => 100,   // 每分钟100次
            'decay_seconds' => 60,
        ],

        // 登录相关接口
        'auth' => [
            'max_attempts' => 50,    // 每分钟50次
            'decay_seconds' => 60,
        ],

        // 文件上传
        'upload' => [
            'max_attempts' => 20,    // 每分钟20次
            'decay_seconds' => 60,
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | 路径模式匹配
    |--------------------------------------------------------------------------
    |
    | 为特定路径模式设置限流规则
    | 支持正则表达式
    |
    */
    'path_patterns' => [
        // 登录接口更严格
        '#^api/v\d+/auth#' => 'auth',
        
        // 文件上传接口
        '#^api/v\d+/.*/upload$#' => 'upload',
        
        // 管理后台
        '#^admin#' => 'admin',
        
        // API写操作
        '#^api/v\d+/(posts|comments|articles)#i' => 'api_write',
    ],

];
