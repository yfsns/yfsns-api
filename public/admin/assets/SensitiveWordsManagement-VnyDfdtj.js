import{i as m,j as e}from"./index-C42INjwk.js";import{r as i}from"./react-vendor-CKx6dMfn.js";import{s as u,F as l,a3 as z,a4 as p,i as P,a6 as J,I as q,o as b,S as ae,B as w,q as be,O as Ce,y as Se,al as Ie,am as ke,an as Fe,P as me,z as pe,r as v,u as T,w as Re,x as le,G as ge,J as Te}from"./antd-vendor-DaJANQRB.js";import"./redux-vendor-DakFfX2h.js";const f={fetchList:async s=>{const c={keyword:s.keyword,category:s.category,level:s.level,action:s.action,isRegex:s.isRegex,status:s.status,page:s.page,perPage:s.perPage,sortField:s.sortField,sortOrder:s.sortOrder},x=(await m.get("/api/admin/sensitive-words",{params:c})).data;return{list:x.data||[],total:x.total||0,currentPage:x.current_page||1,perPage:x.per_page||10,lastPage:x.last_page||1}},fetchStats:async()=>m.get("/api/admin/sensitive-words/stats").then(s=>s.data),fetchOptions:async()=>m.get("/api/admin/sensitive-words/options").then(s=>s.data),fetchDetail:async s=>m.get(`/api/admin/sensitive-words/${s}`).then(c=>c.data),create:async s=>m.post("/api/admin/sensitive-words",s).then(c=>c.data),update:async(s,c)=>m.put(`/api/admin/sensitive-words/${s}`,c).then(M=>M.data),delete:async s=>{await m.delete(`/api/admin/sensitive-words/${s}`)},batchImport:async s=>(await m.post("/api/admin/sensitive-words/batch-import",{...s,isRegex:s.isRegex})).data,batchDelete:async s=>{await m.post("/api/admin/sensitive-words/batch-destroy",{ids:s})},export:async(s={})=>(await m.get("/api/admin/sensitive-words/export",{params:s,responseType:"blob"})).data,testFilter:async s=>(await m.post("/api/admin/sensitive-words/test-filter",{content:s})).data,fetchLogs:async s=>(await m.get("/api/admin/sensitive-words/logs",{params:s})).data},Me=()=>{const[s,c]=i.useState(!1),[M,x]=i.useState([]),[a,N]=i.useState(0),[G,H]=i.useState(null),[y,Q]=i.useState(null),[I,L]=i.useState(!1),[V,k]=i.useState(null),[D,E]=i.useState(!1),[X,W]=i.useState(!1),[Y,A]=i.useState(null),[U,C]=i.useState(!1),d=i.useCallback(async(n={})=>{c(!0);try{const o=await f.fetchList(n);x(o.list||[]),N(o.total||0)}catch{u.error("获取敏感词列表失败")}finally{c(!1)}},[]),h=i.useCallback(async()=>{try{const n=await f.fetchStats();H(n)}catch{}},[]),F=i.useCallback(async()=>{try{const n=await f.fetchOptions();Q(n)}catch{}},[]),S=i.useCallback(async n=>{c(!0);try{await f.delete(n),u.success("删除成功"),await d(),await h()}catch{u.error("删除失败")}finally{c(!1)}},[d,h]),O=i.useCallback(async n=>{c(!0);try{await f.batchDelete(n),u.success("批量删除成功"),await d(),await h()}catch{u.error("批量删除失败")}finally{c(!1)}},[d,h]),B=i.useCallback(n=>{n?(k(n),E(!0)):(k(null),E(!1)),L(!0)},[]),_=i.useCallback(()=>{L(!1),k(null),E(!1)},[]),Z=i.useCallback(async n=>{c(!0);try{D&&V?(await f.update(V.id,n),u.success("更新成功")):(await f.create(n),u.success("创建成功")),L(!1),k(null),E(!1),await d(),await h()}catch{u.error(D?"更新失败":"创建失败")}finally{c(!1)}},[D,V,d,h]),ee=i.useCallback(async n=>{try{const o=await f.testFilter(n);A(o),W(!0)}catch{u.error("测试过滤失败")}},[]),te=i.useCallback(async n=>{c(!0);try{const o=await f.batchImport(n);u.success(`成功导入 ${o.count||n.words.length} 个敏感词`),C(!1),await d(),await h()}catch{u.error("批量导入失败")}finally{c(!1)}},[d,h]),se=i.useCallback(async(n={})=>{try{const o=await f.export(n),K=window.URL.createObjectURL(o),R=document.createElement("a");R.href=K,R.download=`sensitive-words-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(R),R.click(),document.body.removeChild(R),window.URL.revokeObjectURL(K),u.success("导出成功")}catch{u.error("导出失败")}},[]);return i.useEffect(()=>{d(),h(),F()},[d,h,F]),{loading:s,words:M,total:a,stats:G,options:y,editModalVisible:I,editingRecord:V,isEditing:D,testModalVisible:X,testResult:Y,importModalVisible:U,fetchData:d,fetchStats:h,fetchOptions:F,handleDelete:S,handleBatchDelete:O,handleEdit:B,handleCloseModal:_,handleSubmit:Z,handleTestFilter:ee,handleBatchImport:te,handleExport:se,setTestModalVisible:W,setImportModalVisible:C}},{Option:g}=b,{TextArea:re}=q,Pe=()=>{var ne,ie,ce,de,oe,he,ue,xe,je;const{loading:s,words:c,total:M,stats:x,options:a,editModalVisible:N,isEditing:G,testModalVisible:H,testResult:y,importModalVisible:Q,fetchData:I,handleDelete:L,handleBatchDelete:V,handleEdit:k,handleCloseModal:D,handleSubmit:E,handleTestFilter:X,handleBatchImport:W,handleExport:Y,setTestModalVisible:A,setImportModalVisible:U}=Me(),[C]=l.useForm(),[d]=l.useForm(),[h]=l.useForm(),[F]=l.useForm(),[S,O]=i.useState({current:1,pageSize:10}),[B,_]=i.useState([]);i.useEffect(()=>{I({page:1,perPage:10})},[I]);const Z=()=>{const t=C.getFieldsValue();O({current:1,pageSize:S.pageSize}),I({...t,page:1,perPage:S.pageSize||10})},ee=()=>{C.resetFields(),O({current:1,pageSize:S.pageSize}),I({page:1,perPage:S.pageSize||10})},te=()=>{d.resetFields(),k()},se=t=>{d.setFieldsValue({...t,status:t.status}),k(t)},n=async()=>{try{const t=await d.validateFields(),r={...t,status:t.status?1:0};await E(r),d.resetFields()}catch{}},o=async()=>{try{const t=await h.validateFields();await X(t.content)}catch{}},K=async()=>{try{const t=await F.validateFields();await W(t),F.resetFields()}catch{}},R=()=>{if(B.length===0){u.warning("请选择要删除的记录");return}V(B),_([])},ve=()=>{const t=C.getFieldsValue();Y(t)},ye=(t,r)=>{const j=r||(t?"启用":"禁用");return t?e.jsx(T,{color:"green",children:j}):e.jsx(T,{color:"red",children:j})},we=t=>{var j;const r=(j=a==null?void 0:a.levels)==null?void 0:j.find($=>$.value===t);return e.jsx(T,{children:(r==null?void 0:r.label)||t})},fe=t=>{var j;const r=(j=a==null?void 0:a.actions)==null?void 0:j.find($=>$.value===t);return e.jsx(T,{children:(r==null?void 0:r.label)||t})};return e.jsxs("div",{style:{padding:"12px"},children:[x&&e.jsxs(z,{gutter:16,style:{marginBottom:16},children:[e.jsx(p,{span:6,children:e.jsx(P,{children:e.jsx(J,{title:"总数量",value:x.total})})}),e.jsx(p,{span:6,children:e.jsx(P,{children:e.jsx(J,{title:"启用",value:x.active,valueStyle:{color:"#3f8600"}})})}),e.jsx(p,{span:6,children:e.jsx(P,{children:e.jsx(J,{title:"禁用",value:x.inactive,valueStyle:{color:"#cf1322"}})})}),e.jsx(p,{span:6,children:e.jsx(P,{children:e.jsx(J,{title:"今日命中",value:x.todayHits,valueStyle:{color:"#1890ff"}})})})]}),e.jsx(P,{style:{marginBottom:16},children:e.jsxs(l,{form:C,layout:"inline",onFinish:Z,children:[e.jsx(l.Item,{name:"keyword",children:e.jsx(q,{placeholder:"敏感词/描述",style:{width:200}})}),e.jsx(l.Item,{name:"category",children:e.jsxs(b,{placeholder:"分类",style:{width:120},allowClear:!0,children:[e.jsx(g,{value:"",children:"全部"}),(ne=a==null?void 0:a.categories)==null?void 0:ne.map(t=>e.jsx(g,{value:t.value,children:t.label},t.value))]})}),e.jsx(l.Item,{name:"level",children:e.jsxs(b,{placeholder:"级别",style:{width:100},allowClear:!0,children:[e.jsx(g,{value:"",children:"全部"}),(ie=a==null?void 0:a.levels)==null?void 0:ie.map(t=>e.jsx(g,{value:t.value,children:t.label},t.value))]})}),e.jsx(l.Item,{name:"action",children:e.jsxs(b,{placeholder:"动作",style:{width:100},allowClear:!0,children:[e.jsx(g,{value:"",children:"全部"}),(ce=a==null?void 0:a.actions)==null?void 0:ce.map(t=>e.jsx(g,{value:t.value,children:t.label},t.value))]})}),e.jsx(l.Item,{children:e.jsxs(ae,{children:[e.jsx(w,{type:"primary",htmlType:"submit",icon:e.jsx(be,{}),children:"搜索"}),e.jsx(w,{onClick:ee,icon:e.jsx(Ce,{}),children:"重置"})]})})]})}),e.jsxs(P,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs(ae,{children:[e.jsx(w,{type:"primary",icon:e.jsx(Se,{}),onClick:te,children:"新增敏感词"}),e.jsx(w,{icon:e.jsx(Ie,{}),onClick:()=>U(!0),children:"批量导入"}),e.jsx(w,{icon:e.jsx(ke,{}),onClick:ve,children:"导出数据"}),e.jsx(w,{icon:e.jsx(Fe,{}),onClick:()=>A(!0),children:"测试过滤"}),e.jsx(me,{title:"确定要删除选中的记录吗？",onConfirm:R,okText:"确定",cancelText:"取消",children:e.jsx(w,{danger:!0,icon:e.jsx(pe,{}),disabled:B.length===0,children:"批量删除"})})]})}),e.jsxs(v,{dataSource:c,loading:s,rowKey:"id",pagination:{current:S.current,pageSize:S.pageSize,total:M,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`共 ${t} 条记录`,onChange:(t,r)=>{const j=C.getFieldsValue();O({current:t,pageSize:r||10}),I({...j,page:t,perPage:r||10})}},rowSelection:{selectedRowKeys:B,onChange:_},children:[e.jsx(v.Column,{title:"ID",dataIndex:"id",width:80}),e.jsx(v.Column,{title:"敏感词",dataIndex:"word",width:150,render:(t,r)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:t}),r.isRegex&&e.jsx(T,{color:"purple",children:"正则"})]})}),e.jsx(v.Column,{title:"分类",dataIndex:"category",width:100,render:t=>{var j;const r=(j=a==null?void 0:a.categories)==null?void 0:j.find($=>$.value===t);return(r==null?void 0:r.label)||t}}),e.jsx(v.Column,{title:"级别",dataIndex:"level",width:80,render:we}),e.jsx(v.Column,{title:"动作",dataIndex:"action",width:80,render:fe}),e.jsx(v.Column,{title:"替换词",dataIndex:"replacement",width:100,render:t=>t||"-"}),e.jsx(v.Column,{title:"命中次数",dataIndex:"hitCount",width:100,render:t=>e.jsx("span",{style:{color:t>0?"#ff4d4f":"#999"},children:t})}),e.jsx(v.Column,{title:"状态",dataIndex:"status",width:80,render:(t,r)=>ye(t,r.statusText)}),e.jsx(v.Column,{title:"创建时间",dataIndex:"createdAt",width:160,render:t=>t?new Date(t).toLocaleString():"-"}),e.jsx(v.Column,{title:"操作",width:120,render:(t,r)=>e.jsxs(ae,{size:"small",children:[e.jsx(w,{type:"link",icon:e.jsx(Re,{}),onClick:()=>se(r),children:"编辑"}),e.jsx(me,{title:"确定要删除这条记录吗？",onConfirm:()=>L(r.id),okText:"确定",cancelText:"取消",children:e.jsx(w,{type:"link",danger:!0,icon:e.jsx(pe,{}),children:"删除"})})]})})]})]}),e.jsx(le,{title:G?"编辑敏感词":"新增敏感词",open:N,onCancel:D,onOk:n,confirmLoading:s,width:600,children:e.jsxs(l,{form:d,layout:"vertical",initialValues:{status:!0,isRegex:!1,action:"replace",level:"medium"},children:[e.jsx(l.Item,{name:"word",label:"敏感词",rules:[{required:!0,message:"请输入敏感词"},{max:100,message:"敏感词最多100个字符"}],children:e.jsx(q,{placeholder:"请输入敏感词"})}),e.jsxs(z,{gutter:16,children:[e.jsx(p,{span:12,children:e.jsx(l.Item,{name:"category",label:"分类",rules:[{required:!0,message:"请选择分类"}],children:e.jsx(b,{placeholder:"请选择分类",children:(de=a==null?void 0:a.categories)==null?void 0:de.map(t=>e.jsx(g,{value:t.value,children:t.label},t.value))})})}),e.jsx(p,{span:12,children:e.jsx(l.Item,{name:"level",label:"级别",rules:[{required:!0,message:"请选择级别"}],children:e.jsx(b,{placeholder:"请选择级别",children:(oe=a==null?void 0:a.levels)==null?void 0:oe.map(t=>e.jsx(g,{value:t.value,children:t.label},t.value))})})})]}),e.jsxs(z,{gutter:16,children:[e.jsx(p,{span:12,children:e.jsx(l.Item,{name:"action",label:"动作",rules:[{required:!0,message:"请选择动作"}],children:e.jsx(b,{placeholder:"请选择动作",children:(he=a==null?void 0:a.actions)==null?void 0:he.map(t=>e.jsx(g,{value:t.value,children:t.label},t.value))})})}),e.jsx(p,{span:12,children:e.jsx(l.Item,{name:"replacement",label:"替换词",dependencies:["action"],children:({getFieldValue:t})=>t("action")==="replace"?e.jsx(q,{placeholder:"替换词（默认***）"}):null})})]}),e.jsx(l.Item,{name:"isRegex",label:"正则表达式",valuePropName:"checked",children:e.jsx(ge,{})}),e.jsx(l.Item,{name:"description",label:"描述",rules:[{max:200,message:"描述最多200个字符"}],children:e.jsx(re,{placeholder:"请输入描述",rows:3})}),e.jsx(l.Item,{name:"status",label:"状态",valuePropName:"checked",children:e.jsx(ge,{checkedChildren:"启用",unCheckedChildren:"禁用"})})]})}),e.jsxs(le,{title:"测试敏感词过滤",open:H,onCancel:()=>A(!1),footer:null,width:800,children:[e.jsxs(l,{form:h,layout:"vertical",onFinish:o,children:[e.jsx(l.Item,{name:"content",label:"测试内容",rules:[{required:!0,message:"请输入测试内容"}],children:e.jsx(re,{placeholder:"请输入要测试的内容",rows:4})}),e.jsx(l.Item,{children:e.jsx(w,{type:"primary",htmlType:"submit",children:"测试过滤"})})]}),y&&e.jsxs("div",{children:[e.jsx(Te,{}),e.jsx("h4",{children:"过滤结果："}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("strong",{children:"原始内容："}),e.jsx("div",{style:{background:"#f5f5f5",padding:8,borderRadius:4,marginTop:4},children:y.originalContent})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("strong",{children:"过滤后内容："}),e.jsx("div",{style:{background:"#f5f5f5",padding:8,borderRadius:4,marginTop:4},children:y.filteredContent})]}),y.matchedWords.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"匹配的敏感词："}),e.jsx("div",{style:{marginTop:8},children:y.matchedWords.map((t,r)=>e.jsxs(T,{color:"red",style:{marginBottom:4},children:[t.word," (",t.category," - ",t.action,")"]},r))})]}),e.jsxs("div",{style:{marginTop:16},children:[e.jsx(T,{color:y.isBlocked?"red":"green",children:y.isBlocked?"被阻止":"通过"}),e.jsxs("span",{style:{marginLeft:8},children:["动作：",y.actionTaken]})]})]})]}),e.jsx(le,{title:"批量导入敏感词",open:Q,onCancel:()=>U(!1),onOk:K,confirmLoading:s,width:600,children:e.jsxs(l,{form:F,layout:"vertical",initialValues:{action:"replace",level:"medium"},children:[e.jsx(l.Item,{name:"words",label:"敏感词列表",rules:[{required:!0,message:"请输入敏感词列表"}],extra:"每行一个敏感词，或用逗号分隔",children:e.jsx(re,{placeholder:"请输入敏感词，每行一个",rows:8})}),e.jsxs(z,{gutter:16,children:[e.jsx(p,{span:12,children:e.jsx(l.Item,{name:"category",label:"分类",rules:[{required:!0,message:"请选择分类"}],children:e.jsx(b,{placeholder:"请选择分类",children:(ue=a==null?void 0:a.categories)==null?void 0:ue.map(t=>e.jsx(g,{value:t.value,children:t.label},t.value))})})}),e.jsx(p,{span:12,children:e.jsx(l.Item,{name:"level",label:"级别",rules:[{required:!0,message:"请选择级别"}],children:e.jsx(b,{placeholder:"请选择级别",children:(xe=a==null?void 0:a.levels)==null?void 0:xe.map(t=>e.jsx(g,{value:t.value,children:t.label},t.value))})})})]}),e.jsxs(z,{gutter:16,children:[e.jsx(p,{span:12,children:e.jsx(l.Item,{name:"action",label:"动作",rules:[{required:!0,message:"请选择动作"}],children:e.jsx(b,{placeholder:"请选择动作",children:(je=a==null?void 0:a.actions)==null?void 0:je.map(t=>e.jsx(g,{value:t.value,children:t.label},t.value))})})}),e.jsx(p,{span:12,children:e.jsx(l.Item,{name:"replacement",label:"替换词",dependencies:["action"],children:({getFieldValue:t})=>t("action")==="replace"?e.jsx(q,{placeholder:"替换词（默认***）"}):null})})]})]})})]})};export{Pe as default};
