import{j as e}from"./index-C42INjwk.js";import{r as y}from"./react-vendor-CKx6dMfn.js";import{u as ne,R as le,a as re}from"./ReviewActionButtons-FvSUqCE_.js";import{L as ie,S as ae,D as oe}from"./ListPageLayout-DbaJDf8x.js";import{F as r,I as u,o as w,p as ce,S as h,B as v,q as de,O as he,r as o,v as f,u as a,Q as B,P as xe,z as ue,x as M,U as me,V as pe}from"./antd-vendor-DaJANQRB.js";import"./redux-vendor-DakFfX2h.js";const{Option:x}=w,{RangePicker:je}=ce,{TextArea:ge}=u,Se=()=>{var P,T;const{loading:b,posts:F,total:A,editModalVisible:D,isEditing:V,reviewModalVisible:$,reviewingRecord:i,fetchData:m,handleDelete:L,handleCloseModal:O,handleSubmit:_,handleReview:E,handleCloseReviewModal:H,handleReviewSubmit:S}=ne(),[p]=r.useForm(),[C]=r.useForm(),[c,I]=y.useState({current:1,pageSize:10}),W=[{label:"待审核",value:0},{label:"已发布",value:1},{label:"已拒绝",value:2}];y.useEffect(()=>{m({page:1,perPage:10})},[]);const q=()=>{const t=p.getFieldsValue();I({current:1,pageSize:c.pageSize}),m({...t,page:1,perPage:c.pageSize})},Q=()=>{p.resetFields(),I({current:1,pageSize:c.pageSize}),m({page:1,perPage:c.pageSize})},U=t=>{E(t)},J=async t=>{if(i)try{await S({...t,status:"published"})}catch{}},K=async t=>{if(i)try{await S({...t,status:"rejected"})}catch{}},N=async()=>{try{const t=await C.validateFields();await _(t),C.resetFields()}catch{}},[G,R]=y.useState(!1),[n,k]=y.useState(null),X=t=>{k(t),R(!0)},Y=()=>{R(!1),k(null)},Z=t=>{if(t.title&&t.title.trim())return t.title.trim();const s=t.content||t.contentHtml||t.rawContent;if(s){const l=s.replace(/<[^>]*>/g,"").trim();return l.length>100?l.substring(0,100)+"...":l}return"无内容"},ee=t=>{let s="";if(t.title&&t.title.trim()&&(s+=`标题：${t.title.trim()}

`),t.content){const l=t.content.replace(/<[^>]*>/g,"").trim();s+=`内容：${l}`}return s||"无内容"};return e.jsxs(e.Fragment,{children:[e.jsxs(ie,{children:[e.jsx(ae,{children:e.jsxs(r,{form:p,layout:"inline",onFinish:q,style:{marginBottom:0},children:[e.jsx(r.Item,{name:"keyword",children:e.jsx(u,{placeholder:"标题/内容/作者",style:{width:200}})}),e.jsx(r.Item,{name:"status",children:e.jsxs(w,{placeholder:"选择状态",style:{width:120},allowClear:!0,children:[e.jsx(x,{value:"",children:"全部"}),e.jsx(x,{value:0,children:"待审核"}),e.jsx(x,{value:1,children:"已发布"}),e.jsx(x,{value:2,children:"已拒绝"})]})}),e.jsx(r.Item,{name:"category",children:e.jsx(u,{placeholder:"分类",style:{width:120}})}),e.jsx(r.Item,{name:"createdAt",children:e.jsx(je,{placeholder:["开始时间","结束时间"],style:{width:240}})}),e.jsx(r.Item,{children:e.jsxs(h,{children:[e.jsx(v,{type:"primary",htmlType:"submit",icon:e.jsx(de,{}),children:"搜索"}),e.jsx(v,{onClick:Q,icon:e.jsx(he,{}),children:"重置"})]})})]})}),e.jsx(oe,{children:e.jsxs(o,{dataSource:F,loading:b,rowKey:"id",pagination:{current:c.current,pageSize:c.pageSize,total:A,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`共 ${t} 条记录`,onChange:(t,s)=>{const l=p.getFieldsValue();I({current:t,pageSize:s||10}),m({...l,page:t,perPage:s||10})},hideOnSinglePage:!1},scroll:{x:"max-content"},children:[e.jsx(o.Column,{title:"ID",dataIndex:"id",width:80}),e.jsx(o.Column,{title:"内容",dataIndex:"content",width:300,ellipsis:{showTitle:!1},render:(t,s)=>{const l=Z(s),d=ee(s);return e.jsx(f,{placement:"topLeft",title:d,styles:{root:{maxWidth:"400px",whiteSpace:"pre-wrap"}},children:e.jsx("span",{style:{display:"inline-block",maxWidth:280,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l})})}}),e.jsx(o.Column,{title:"作者",dataIndex:"author",width:120,render:(t,s)=>(t==null?void 0:t.nickname)||(t==null?void 0:t.username)||"-"}),e.jsx(o.Column,{title:"类型",dataIndex:"type",width:100,render:t=>{const l={post:{text:"普通动态",color:"default"},image:{text:"图片动态",color:"blue"},video:{text:"视频动态",color:"purple"}}[t]||{text:"未知",color:"default"};return e.jsx(a,{color:l.color,children:l.text})}}),e.jsx(o.Column,{title:"话题",dataIndex:"topics",width:150,render:t=>!t||t.length===0?"-":t.slice(0,2).map(s=>e.jsx(a,{color:"blue",children:s},s)).concat(t.length>2?[e.jsxs(a,{children:["+",t.length-2]},"more")]:[])}),e.jsx(o.Column,{title:"状态",dataIndex:"statusText",width:100,render:(t,s)=>{const l=s.status,j={0:"orange",1:"green",2:"red"}[l]||"default";return e.jsx(a,{color:j,children:t})}}),e.jsx(o.Column,{title:"审核记录",width:250,render:(t,s)=>{const l=s.auditRecords;if(!l||!Array.isArray(l)||l.length===0)return s.status===0?e.jsx("span",{style:{color:"#999"},children:"-"}):e.jsx("span",{style:{color:"#999"},children:"暂无审核记录"});const d=l[0],j=l.length,z=d.channelType||"manual",te=d.channel||(z==="ai"?"AI":"人工"),se=z==="ai"?"purple":"blue",g=d.reason||"";return e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsx("div",{style:{marginBottom:4},children:e.jsxs(h,{size:4,children:[e.jsxs(a,{color:se,style:{margin:0},children:[te,"审核"]}),j>1&&e.jsxs(a,{color:"default",style:{margin:0},children:["共",j,"条"]})]})}),g&&e.jsx(f,{title:g,placement:"topLeft",children:e.jsx("div",{style:{color:"#666",maxWidth:220,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:g})}),!g&&e.jsx("span",{style:{color:"#999"},children:"无备注"})]})}}),e.jsx(o.Column,{title:"创建时间",dataIndex:"createdAt",width:160,render:(t,s)=>s.createdAtDatetime||s.createdAtHuman||s.createdAt||t||"-"}),e.jsx(o.Column,{title:"操作",width:200,fixed:"right",render:(t,s)=>e.jsxs(h,{size:"small",children:[e.jsx(le,{record:s,onReview:U}),e.jsx(f,{title:"查看详情",children:e.jsx(v,{type:"link",icon:e.jsx(B,{}),onClick:()=>X(s)})}),e.jsx(xe,{title:"确定要删除这条记录吗？",onConfirm:()=>L(s.id),okText:"确定",cancelText:"取消",children:e.jsx(f,{title:"删除",children:e.jsx(v,{type:"link",danger:!0,icon:e.jsx(ue,{})})})})]})})]})})]}),e.jsx(M,{title:V?"编辑文章":"新增文章",open:D,onCancel:O,onOk:N,confirmLoading:b,width:800,children:e.jsxs(r,{form:C,layout:"vertical",initialValues:{status:0,topics:[]},children:[e.jsx(r.Item,{name:"title",label:"标题",rules:[{max:100,message:"标题最多100个字符"}],children:e.jsx(u,{placeholder:"请输入标题"})}),e.jsx(r.Item,{name:"content",label:"内容",rules:[{required:!0,message:"请输入内容"}],children:e.jsx(ge,{placeholder:"请输入内容",rows:6})}),e.jsx(r.Item,{name:"category",label:"分类",children:e.jsx(u,{placeholder:"请输入分类"})}),e.jsx(r.Item,{name:"topics",label:"话题",children:e.jsx(w,{mode:"tags",placeholder:"请输入话题，按回车添加",style:{width:"100%"}})}),e.jsx(r.Item,{name:"status",label:"状态",rules:[{required:!0,message:"请选择状态"}],children:e.jsx(w,{placeholder:"请选择状态",children:W.map(t=>e.jsx(x,{value:t.value,children:t.label},t.value))})})]})}),e.jsx(re,{open:$,loading:b,record:i?{title:i.title,content:i.content,author:i.author?{id:typeof i.author.id=="number"?i.author.id:Number(i.author.id),nickname:i.author.nickname,username:i.author.username,avatar:i.author.avatarUrl}:void 0}:void 0,onApprove:J,onReject:K,onCancel:H,showType:!1}),e.jsx(M,{title:"动态详情",open:G,onCancel:Y,footer:null,width:800,children:n&&e.jsx("div",{style:{padding:"16px 0"},children:e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8},children:"动态信息："}),e.jsxs("div",{style:{padding:12,background:"#f5f5f5",borderRadius:4},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"标题："}),n.title||"无标题"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"内容："}),e.jsx("div",{style:{marginTop:4,padding:8,background:"#fff",borderRadius:4,maxHeight:200,overflow:"auto"},children:n.content?e.jsx("div",{dangerouslySetInnerHTML:{__html:n.content}}):"无内容"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"类型："}),n.type==="post"&&e.jsx(a,{children:"普通动态"}),n.type==="image"&&e.jsx(a,{color:"blue",children:"图片动态"}),n.type==="video"&&e.jsx(a,{color:"purple",children:"视频动态"}),!n.type&&e.jsx(a,{children:"普通动态"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"作者："}),((P=n.author)==null?void 0:P.nickname)||"未知"," (@",((T=n.author)==null?void 0:T.username)||"未知",")"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"状态："}),e.jsx(a,{color:n.status===1?"green":n.status===0?"orange":n.status===2?"red":"default",children:n.status===1?"已发布":n.status===0?"待审核":n.status===2?"已拒绝":"未知"})]}),n.category&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"分类："}),n.category]}),n.topics&&n.topics.length>0&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"话题："}),e.jsx(h,{size:4,children:n.topics.map((t,s)=>e.jsxs(a,{color:"blue",children:["#",t]},s))})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"统计："}),e.jsxs(h,{size:8,children:[e.jsxs("span",{children:[e.jsx(B,{})," ",n.views||0," 浏览"]}),e.jsxs("span",{children:[e.jsx(me,{})," ",n.likes||0," 点赞"]}),e.jsxs("span",{children:[e.jsx(pe,{})," ",n.commentsCount||0," 评论"]})]})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"创建时间："}),n.createdAt]}),e.jsxs("div",{children:[e.jsx("strong",{children:"更新时间："}),n.updatedAt]})]})]})})})]})};export{Se as default};
