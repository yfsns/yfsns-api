import{j as t}from"./index-CfjFDGFk.js";import{r as w}from"./react-vendor-CKx6dMfn.js";import{c as Q,R as U,a as G}from"./ReviewActionButtons-BmTxh0Ti.js";import{L as X,S as Z,D as ee}from"./ListPageLayout-BDuwteGO.js";import{F as s,v as f,u as c,S as x,B as o,w as te,P as ae,z as ne,I as d,o as p,p as re,q as se,O as le,r as ie,x as oe}from"./antd-vendor-DaJANQRB.js";import"./redux-vendor-DakFfX2h.js";const{Option:I}=p,{RangePicker:ce}=re,{TextArea:de}=d,ye=()=>{const{loading:C,posts:D,total:M,editModalVisible:z,editingRecord:P,isEditing:v,reviewModalVisible:Y,reviewingRecord:i,fetchData:h,handleDelete:T,handleEdit:F,handleCloseModal:b,handleSubmit:A,handleReview:$,handleCloseReviewModal:B,handleReviewSubmit:R}=Q(),[g]=s.useForm(),[O]=s.useForm(),[u,j]=w.useState({current:1,pageSize:10}),[V,m]=w.useState([]),y=[{label:"待审核",value:0},{label:"已发布",value:1},{label:"已拒绝",value:2}];w.useEffect(()=>{h({page:1,perPage:10})},[]);const L=async e=>{const a={page:1,perPage:u.pageSize,...e};e.dateRange&&e.dateRange.length===2&&(a.startDate=e.dateRange[0].format("YYYY-MM-DD"),a.endDate=e.dateRange[1].format("YYYY-MM-DD")),await h(a),j(n=>({...n,current:1})),m([])},E=()=>{g.resetFields(),h({page:1,perPage:u.pageSize}),j(e=>({...e,current:1})),m([])},q=async(e,a,n)=>{const r={page:e.current,perPage:e.pageSize},l=g.getFieldsValue();l.keyword&&(r.keyword=l.keyword),l.status!==void 0&&(r.status=l.status),l.category&&(r.category=l.category),l.dateRange&&l.dateRange.length===2&&(r.startDate=l.dateRange[0].format("YYYY-MM-DD"),r.endDate=l.dateRange[1].format("YYYY-MM-DD")),n.field&&n.order&&(r.sortField=n.field,r.sortOrder=n.order==="ascend"?"asc":"desc"),await h(r),j({current:e.current,pageSize:e.pageSize}),m([])},K=e=>{if(e.title&&e.title.trim())return e.title.trim();const a=e.content||e.contentHtml||e.rawContent;if(a){const n=a.replace(/<[^>]*>/g,"").trim();return n.length>100?n.substring(0,100)+"...":n}return"无内容"},N=e=>{let a="";if(e.title&&e.title.trim()&&(a+=`标题：${e.title.trim()}

`),e.content){const n=e.content.replace(/<[^>]*>/g,"").trim();a+=`内容：${n}`}return a||"无内容"},W=[{title:"ID",dataIndex:"id",key:"id",width:80,sorter:!0},{title:"内容",dataIndex:"content",key:"content",width:300,render:(e,a)=>{const n=K(a),r=N(a);return t.jsx(f,{placement:"topLeft",title:r,styles:{root:{maxWidth:"400px",whiteSpace:"pre-wrap"}},children:t.jsx("span",{style:{display:"inline-block",maxWidth:280,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})})}},{title:"作者",dataIndex:"user",key:"user",width:120,render:e=>(e==null?void 0:e.nickname)||"未知"},{title:"类型",dataIndex:"type",key:"type",width:100,render:e=>{const n={post:{text:"普通动态",color:"default"},image:{text:"图片动态",color:"blue"},video:{text:"视频动态",color:"purple"}}[e]||{text:"未知",color:"default"};return t.jsx(c,{color:n.color,children:n.text})}},{title:"话题",dataIndex:"topics",key:"topics",width:150,render:e=>!e||e.length===0?"-":e.slice(0,2).map(a=>t.jsx(c,{color:"blue",children:a},a)).concat(e.length>2?[t.jsxs(c,{children:["+",e.length-2]},"more")]:[])},{title:"状态",dataIndex:"status",key:"status",width:100,render:e=>{const n={0:{text:"待审核",color:"orange"},1:{text:"已发布",color:"green"},2:{text:"已拒绝",color:"red"}}[e]||{text:"未知",color:"default"};return t.jsx(c,{color:n.color,children:n.text})},filters:y.map(e=>({text:e.label,value:e.value})),onFilter:(e,a)=>a.status===e},{title:"审核记录",width:250,render:(e,a)=>{const n=a.auditRecords;if(!n||!Array.isArray(n)||n.length===0)return a.status===0?t.jsx("span",{style:{color:"#999"},children:"-"}):t.jsx("span",{style:{color:"#999"},children:"暂无审核记录"});const r=n[0],l=n.length,k=r.channelType||"manual",H=r.channel||(k==="ai"?"AI":"人工"),J=k==="ai"?"purple":"blue",S=r.reason||"";return t.jsxs("div",{style:{fontSize:"12px"},children:[t.jsx("div",{style:{marginBottom:4},children:t.jsxs(x,{size:4,children:[t.jsxs(c,{color:J,style:{margin:0},children:[H,"审核"]}),t.jsx("span",{style:{color:"#666"},children:l>1?`共${l}次`:""})]})}),t.jsx("div",{style:{color:"#999",marginBottom:2},children:new Date(r.createdAt).toLocaleString("zh-CN")}),S&&t.jsxs("div",{style:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"#666"},children:["原因: ",S]})]})}},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:160,sorter:!0,render:e=>e?new Date(e).toLocaleString("zh-CN"):"-"},{title:"操作",key:"action",width:200,render:(e,a)=>t.jsxs(x,{size:"small",children:[t.jsx(U,{record:a,isPending:n=>n.status===0,onReview:$}),t.jsx(f,{title:"编辑",children:t.jsx(o,{type:"link",icon:t.jsx(te,{}),onClick:()=>F(a),size:"small"})}),t.jsx(f,{title:"删除",children:t.jsx(ae,{title:"确认删除？",description:`确定要删除视频动态"${a.title}"吗？`,onConfirm:()=>T(a.id),okText:"确定",cancelText:"取消",children:t.jsx(o,{type:"link",danger:!0,icon:t.jsx(ne,{}),size:"small"})})})]})}],_={selectedRowKeys:V,onChange:e=>m(e)};return t.jsxs(t.Fragment,{children:[t.jsxs(X,{children:[t.jsx(Z,{children:t.jsxs(s,{form:g,onFinish:L,layout:"inline",style:{marginBottom:0},children:[t.jsx(s.Item,{name:"keyword",label:"关键词",children:t.jsx(d,{placeholder:"标题、内容关键词",style:{width:200}})}),t.jsx(s.Item,{name:"status",label:"状态",children:t.jsx(p,{placeholder:"选择状态",style:{width:120},children:y.map(e=>t.jsx(I,{value:e.value,children:e.label},e.value))})}),t.jsx(s.Item,{name:"category",label:"分类",children:t.jsx(d,{placeholder:"分类关键词",style:{width:150}})}),t.jsx(s.Item,{name:"dateRange",label:"发布时间",children:t.jsx(ce,{})}),t.jsx(s.Item,{children:t.jsxs(x,{children:[t.jsx(o,{type:"primary",htmlType:"submit",icon:t.jsx(se,{}),children:"搜索"}),t.jsx(o,{onClick:E,icon:t.jsx(le,{}),children:"重置"})]})})]})}),t.jsx(ee,{children:t.jsx(ie,{rowSelection:_,columns:W,dataSource:D,loading:C,rowKey:"id",pagination:{current:u.current,pageSize:u.pageSize,total:M,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,a)=>`第 ${a[0]}-${a[1]} 条，共 ${e} 条`},onChange:q,scroll:{x:1200}})})]}),t.jsx(oe,{title:v?"编辑视频动态":"新增视频动态",open:z,onCancel:b,footer:null,width:800,destroyOnClose:!0,children:t.jsxs(s,{form:O,onFinish:A,layout:"vertical",initialValues:P||{},children:[t.jsx(s.Item,{name:"title",label:"标题",rules:[{required:!0,message:"请输入标题"}],children:t.jsx(d,{placeholder:"请输入视频动态标题"})}),t.jsx(s.Item,{name:"content",label:"内容",rules:[{required:!0,message:"请输入内容"}],children:t.jsx(de,{rows:6,placeholder:"请输入视频动态内容"})}),t.jsx(s.Item,{name:"category",label:"分类",rules:[{required:!0,message:"请输入分类"}],children:t.jsx(d,{placeholder:"请输入分类"})}),t.jsx(s.Item,{name:"topics",label:"话题标签",children:t.jsx(p,{mode:"tags",placeholder:"输入话题标签，按回车添加",style:{width:"100%"}})}),t.jsx(s.Item,{name:"status",label:"状态",children:t.jsx(p,{placeholder:"选择状态",children:y.map(e=>t.jsx(I,{value:e.value,children:e.label},e.value))})}),t.jsx(s.Item,{style:{textAlign:"right",marginBottom:0},children:t.jsxs(x,{children:[t.jsx(o,{onClick:b,children:"取消"}),t.jsx(o,{type:"primary",htmlType:"submit",children:v?"更新":"创建"})]})})]})}),t.jsx(G,{open:Y,record:i?{title:i.title,content:i.content,author:i.author?{id:typeof i.author.id=="number"?i.author.id:Number(i.author.id),nickname:i.author.nickname,username:i.author.username,avatar:i.author.avatarUrl}:void 0}:void 0,onApprove:async e=>{i&&await R({status:"published",remark:e.remark})},onReject:async e=>{i&&await R({status:"rejected",remark:e.remark})},onCancel:B,showType:!1})]})};export{ye as default};
