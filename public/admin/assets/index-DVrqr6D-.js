import{i as x,j as e}from"./index-CfjFDGFk.js";import{r as d}from"./react-vendor-CKx6dMfn.js";import{s as h,F as g,S as v,i as L,I as R,o as O,B as m,q as X,O as V,r as Y,x as Z,u as _,v as q,w as ee,P as te,z as se}from"./antd-vendor-DaJANQRB.js";import"./redux-vendor-DakFfX2h.js";const w={getList:async c=>{const p=(await x.get("/api/admin/topic",{params:c})).data;return{list:p.data||[],total:p.total||0,page:p.page||p.current_page||1,perPage:p.per_page||10,lastPage:p.last_page||1,hasMore:p.has_more||!1}},getDetail:async c=>(await x.get(`/api/admin/topic/${c}`)).data,create:async c=>(await x.post("/api/admin/topic",c)).data,update:async(c,a)=>(await x.put(`/api/admin/topic/${c}`,a)).data,delete:async c=>(await x.delete(`/api/admin/topic/${c}`)).data,review:async(c,a)=>(await x.put(`/api/admin/topic/${c}/review`,a)).data,batchDelete:async c=>(await x.post("/api/admin/topic/batch-delete",{ids:c})).data,batchReview:async c=>(await x.post("/api/admin/topic/batch-review",c)).data,getStatistics:async()=>(await x.get("/api/admin/topic/statistics")).data},ae=()=>{const[c,a]=d.useState(!1),[p,f]=d.useState([]),[b,j]=d.useState(0),[C,S]=d.useState({total:0,active:0,inactive:0}),o=d.useCallback(async i=>{var l,r;a(!0);try{const u=await w.getList(i);f(u.list||[]),j(u.total||0)}catch(s){h.error(((r=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:r.message)||"获取话题列表失败"),f([]),j(0)}finally{a(!1)}},[]),I=d.useCallback(async()=>{try{const i=await w.getStatistics();S(i)}catch(i){console.error("获取统计数据失败:",i)}},[]),z=d.useCallback(async i=>{var l,r;a(!0);try{const s=await w.create(i);return h.success("话题创建成功"),await o(),!0}catch(s){return h.error(((r=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:r.message)||"创建话题失败"),!1}finally{a(!1)}},[o]),$=d.useCallback(async(i,l)=>{var r,s;a(!0);try{const u=await w.update(i,l);return h.success("话题更新成功"),await o(),!0}catch(u){return h.error(((s=(r=u==null?void 0:u.response)==null?void 0:r.data)==null?void 0:s.message)||"更新话题失败"),!1}finally{a(!1)}},[o]),k=d.useCallback(async i=>{var l,r;a(!0);try{const s=await w.delete(i);return h.success("话题删除成功"),await o(),!0}catch(s){return h.error(((r=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:r.message)||"删除话题失败"),!1}finally{a(!1)}},[o]),A=d.useCallback(async i=>{var l,r;a(!0);try{const s=await w.batchDelete(i);return h.success(`成功删除 ${i.length} 个话题`),await o(),!0}catch(s){return h.error(((r=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:r.message)||"批量删除失败"),!1}finally{a(!1)}},[o]),D=d.useCallback(async(i,l)=>{var r,s;a(!0);try{const u=await w.review(i,l);return h.success("话题审核成功"),await o(),!0}catch(u){return h.error(((s=(r=u==null?void 0:u.response)==null?void 0:r.data)==null?void 0:s.message)||"审核话题失败"),!1}finally{a(!1)}},[o]),T=d.useCallback(async i=>{var l,r;a(!0);try{const s=await w.batchReview(i);return h.success(`成功审核 ${i.ids.length} 个话题`),await o(),!0}catch(s){return h.error(((r=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:r.message)||"批量审核失败"),!1}finally{a(!1)}},[o]);return{loading:c,topics:p,total:b,statistics:C,fetchTopics:o,fetchStatistics:I,createTopic:z,updateTopic:$,deleteTopic:k,batchDeleteTopics:A,reviewTopic:D,batchReviewTopics:T}},{Option:K}=O,{TextArea:le}=R,de=()=>{const[c,a]=d.useState(!1),[p,f]=d.useState(null),[b,j]=d.useState(!1),[C]=g.useForm(),[S]=g.useForm(),[o,I]=d.useState({current:1,pageSize:10}),[z,$]=d.useState([]),{loading:k,topics:A,total:D,fetchTopics:T,createTopic:i,updateTopic:l,deleteTopic:r}=ae();d.useEffect(()=>{T({page:1,per_page:10})},[]);const s=async(t={})=>{await T({page:t.page||o.current,per_page:t.perPage||o.pageSize,keyword:t.keyword,status:t.status})},u=async t=>{I(n=>({...n,current:1})),await T({...t,page:1,per_page:o.pageSize})},W=t=>{I(t),T({page:t.current,per_page:t.pageSize,...C.getFieldsValue()})},H=t=>{f(t),j(!0),a(!0),S.setFieldsValue(t)},J=async t=>{await r(t)},N=async t=>{let n=!1;b&&p?n=await l(p.id,t):n=await i(t),n&&(a(!1),f(null),j(!1),S.resetFields())},E=()=>{a(!1),f(null),j(!1),S.resetFields()},Q=[{title:"ID",dataIndex:"id",key:"id",width:80,sorter:(t,n)=>t.id-n.id},{title:"话题名称",dataIndex:"name",key:"name",width:150,render:t=>e.jsxs("span",{style:{fontWeight:"bold",color:"#1890ff"},children:["#",t]})},{title:"描述",dataIndex:"description",key:"description",width:200,ellipsis:!0},{title:"动态数",dataIndex:"postCount",key:"postCount",width:100,sorter:(t,n)=>(t.postCount||0)-(n.postCount||0)},{title:"关注数",dataIndex:"followerCount",key:"followerCount",width:100,sorter:(t,n)=>(t.followerCount||0)-(n.followerCount||0)},{title:"浏览数",dataIndex:"viewCount",key:"viewCount",width:100,sorter:(t,n)=>(t.viewCount||0)-(n.viewCount||0)},{title:"热度",dataIndex:"hotScoreText",key:"hotScoreText",width:80,render:(t,n)=>e.jsx(_,{color:n.isHot?"red":"default",children:t})},{title:"状态",dataIndex:"status",key:"status",width:80,render:t=>{const n={0:{color:"orange",text:"待审核"},1:{color:"green",text:"启用"},2:{color:"red",text:"禁用"}},y=n[t]||n[0];return e.jsx(_,{color:y.color,children:y.text})}},{title:"审核记录",width:250,render:(t,n)=>{const y=n.auditRecords;if(!y||!Array.isArray(y)||y.length===0)return n.status===0?e.jsx("span",{style:{color:"#999"},children:"-"}):e.jsx("span",{style:{color:"#999"},children:"暂无审核记录"});const F=y[0],M=y.length,P=F.channelType||"manual",G=F.channel||(P==="ai"?"AI":"人工"),U=P==="ai"?"purple":"blue",B=F.reason||"";return e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsx("div",{style:{marginBottom:4},children:e.jsxs(v,{size:4,children:[e.jsxs(_,{color:U,style:{margin:0},children:[G,"审核"]}),e.jsx("span",{style:{color:"#666"},children:M>1?`共${M}次`:""})]})}),e.jsx("div",{style:{color:"#999",marginBottom:2},children:new Date(F.createdAt).toLocaleString("zh-CN")}),B&&e.jsxs("div",{style:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"#666"},children:["原因: ",B]})]})}},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:120},{title:"操作",key:"action",width:150,render:(t,n)=>e.jsxs(v,{size:4,children:[e.jsx(q,{title:"编辑话题",children:e.jsx(m,{type:"link",icon:e.jsx(ee,{}),onClick:()=>H(n)})}),e.jsx(te,{title:"确定删除这个话题吗？",description:"删除后不可恢复，请谨慎操作",onConfirm:()=>J(n.id),okText:"确定",cancelText:"取消",children:e.jsx(q,{title:"删除话题",children:e.jsx(m,{type:"link",danger:!0,icon:e.jsx(se,{})})})})]})}];return e.jsxs("div",{style:{padding:"12px"},children:[e.jsxs(v,{direction:"vertical",size:16,style:{width:"100%"},children:[e.jsx(L,{size:"small",style:{marginBottom:"16px"},children:e.jsxs(g,{form:C,layout:"inline",onFinish:u,style:{marginBottom:0},children:[e.jsx(g.Item,{name:"keyword",label:"关键词",children:e.jsx(R,{placeholder:"话题名称或描述",style:{width:200}})}),e.jsx(g.Item,{name:"status",label:"状态",children:e.jsxs(O,{placeholder:"选择状态",style:{width:120},allowClear:!0,children:[e.jsx(K,{value:1,children:"活跃"}),e.jsx(K,{value:0,children:"停用"})]})}),e.jsx(g.Item,{children:e.jsxs(v,{children:[e.jsx(m,{type:"primary",htmlType:"submit",icon:e.jsx(X,{}),children:"搜索"}),e.jsx(m,{icon:e.jsx(V,{}),onClick:()=>{C.resetFields(),s({page:1,perPage:o.pageSize})},children:"重置"}),e.jsx(m,{icon:e.jsx(V,{}),onClick:()=>s({page:o.current,perPage:o.pageSize,...C.getFieldsValue()}),loading:k,children:"刷新"})]})})]})}),e.jsx(L,{children:e.jsx(Y,{columns:Q,dataSource:A,rowKey:"id",loading:k,rowSelection:{selectedRowKeys:z,onChange:$},pagination:{...o,total:D,showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,n)=>`第 ${n[0]}-${n[1]} 条，共 ${t} 条`},onChange:W,scroll:{x:1e3}})})]}),e.jsx(Z,{title:b?"编辑话题":"新增话题",open:c,onCancel:E,footer:null,width:600,children:e.jsxs(g,{form:S,layout:"vertical",onFinish:N,children:[e.jsx(g.Item,{label:"话题名称",name:"name",rules:[{required:!0,message:"请输入话题名称"},{max:20,message:"话题名称不能超过20个字符"}],children:e.jsx(R,{placeholder:"请输入话题名称"})}),e.jsx(g.Item,{label:"话题描述",name:"description",rules:[{required:!0,message:"请输入话题描述"},{max:100,message:"话题描述不能超过100个字符"}],children:e.jsx(R.TextArea,{rows:3,placeholder:"请输入话题描述",showCount:!0,maxLength:100})}),e.jsx(g.Item,{style:{marginBottom:0,textAlign:"right"},children:e.jsxs(v,{children:[e.jsx(m,{onClick:E,children:"取消"}),e.jsx(m,{type:"primary",htmlType:"submit",loading:k,children:b?"更新":"创建"})]})})]})})]})};export{de as TopicManagement};
