import{i as c,j as e}from"./index-C42INjwk.js";import{r as i}from"./react-vendor-CKx6dMfn.js";import{F as m,s as v,S as j,i as D,r as O,ao as V,x as J,T as K,I as U,B as h,A as W,a as G,v as w,u as _,a1 as N,a0 as X,Q as Y,o as Z}from"./antd-vendor-DaJANQRB.js";import"./redux-vendor-DakFfX2h.js";const B={getList:async r=>{const l=(await c.get("/api/admin/reports",{params:r})).data;return{list:l.list||[],total:l.total||0,page:l.page||l.current_page||1,per_page:l.per_page||20}},getDetail:r=>c.get(`/api/admin/reports/${r}`).then(a=>a.data),handleReport:(r,a)=>c.post(`/api/admin/reports/${r}/handle`,a).then(l=>l.data),batchHandleReports:r=>c.post("/api/admin/reports/batch-handle",r).then(a=>a.data),getStatistics:()=>c.get("/api/admin/reports/statistics").then(r=>r.data),exportReports:r=>c.get("/api/admin/reports/export",{params:r,responseType:"blob"}).then(a=>a.data)},{Option:ie}=Z,{TextArea:ee}=U,le=()=>{var z,C,I,A;const[r,a]=i.useState(!1),[l,F]=i.useState([]),[b,$]=i.useState(0),[M,k]=i.useState(1),[P,S]=i.useState(20),[L,x]=i.useState(!1),[n,u]=i.useState(null),[o,H]=i.useState("handled"),[p]=m.useForm(),[R,te]=i.useState({page:1,per_page:20,sort_field:"created_at",sort_order:"desc"});i.useEffect(()=>{g()},[]);const y=t=>({spam:"垃圾信息",harassment:"骚扰",inappropriate:"不当内容",copyright:"版权侵权",fake:"虚假信息",post:"动态举报",other:"其他"})[t]||t,T=t=>t.includes("Post")?"动态":t.includes("Comment")?"评论":t.includes("User")?"用户":"其他",q=t=>{const s={1:{color:"green",text:"已处理"},0:{color:"orange",text:"待处理"}},d=s[t]||s[0];return e.jsx(_,{color:d.color,children:d.text})},g=i.useCallback(async t=>{a(!0);try{const s={...R,...t},d=await B.getList(s);F(d.list),$(d.total),k(d.page),S(d.per_page)}catch{v.error("获取举报列表失败")}finally{a(!1)}},[R]),f=i.useCallback(async(t,s)=>{u(t),H(s),x(!0)},[]),E=i.useCallback(async t=>{if(n)try{a(!0),await B.handleReport(n.id,{status:o,result:t.result,remark:t.remark}),x(!1),u(null),p.resetFields(),v.success(`举报${o==="handled"?"处理":"拒绝"}成功`),g()}catch{v.error("操作失败，请重试")}finally{a(!1)}},[n,o,p,g]),Q=[{title:"举报人",dataIndex:"reporter",key:"reporter",width:150,render:t=>t?e.jsxs(j,{children:[e.jsx(W,{size:"small",src:t.avatar,icon:e.jsx(G,{})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"12px",lineHeight:"1.2"},children:t.nickname}),e.jsxs("div",{style:{fontSize:"11px",color:"#999",lineHeight:"1.2"},children:["@",t.username]})]})]}):e.jsx("span",{style:{color:"#999"},children:"未知用户"})},{title:"被举报内容",dataIndex:"reportable",key:"reportable",width:200,render:t=>t?e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"12px",lineHeight:"1.2"},children:T(t.type)}),e.jsx(w,{title:t.content,children:e.jsx("div",{style:{maxWidth:"180px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"11px",color:"#999"},children:t.content})})]}):e.jsx("span",{style:{color:"#999"},children:"无数据"})},{title:"举报类型",dataIndex:"type",key:"type",width:100,render:t=>y(t)},{title:"举报原因",dataIndex:"reason",key:"reason",width:100,render:t=>e.jsx(_,{children:y(t)})},{title:"状态",dataIndex:"status",key:"status",width:80,render:t=>q(t)},{title:"举报时间",dataIndex:"createdAt",key:"createdAt",width:120,render:t=>e.jsxs("div",{style:{fontSize:"12px"},children:[t.split(" ")[0],e.jsx("br",{}),t.split(" ")[1]]})},{title:"操作",key:"action",width:150,render:(t,s)=>s.status!==1?e.jsxs(j,{size:4,children:[e.jsx(w,{title:"处理举报",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(N,{style:{color:"#52c41a"}}),onClick:()=>f(s,"handled"),disabled:r})}),e.jsx(w,{title:"拒绝举报",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(X,{style:{color:"#ff4d4f"}}),onClick:()=>f(s,"rejected"),disabled:r})})]}):e.jsx(h,{type:"link",size:"small",icon:e.jsx(Y,{}),onClick:()=>f(s,"handled"),disabled:r,children:"查看"})}];return e.jsxs("div",{style:{padding:"12px"},children:[e.jsx(j,{direction:"vertical",size:16,style:{width:"100%"},children:e.jsxs(D,{size:"small",children:[e.jsx(O,{columns:Q,dataSource:l,rowKey:"id",loading:r,size:"small",pagination:!1,scroll:{x:800}}),b>0&&e.jsx("div",{style:{marginTop:16,textAlign:"right"},children:e.jsx(V,{current:M,pageSize:P,total:b,showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,s)=>`第 ${s[0]}-${s[1]} 条，共 ${t} 条`,onChange:(t,s)=>{k(t),S(s||20),g({page:t,per_page:s})}})})]})}),e.jsx(J,{title:o==="handled"?"处理举报":"拒绝举报",open:L,onCancel:()=>{x(!1),u(null),p.resetFields()},footer:null,width:600,children:n&&e.jsxs(m,{form:p,layout:"vertical",onFinish:E,children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(K.Text,{strong:!0,children:"举报详情："}),e.jsxs("div",{style:{marginTop:8,padding:12,background:"#f5f5f5",borderRadius:4},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"举报人："}),((z=n.reporter)==null?void 0:z.nickname)||"未知用户",((C=n.reporter)==null?void 0:C.username)&&e.jsxs("span",{style:{color:"#666",fontSize:"12px"},children:["(@",n.reporter.username,")"]})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"被举报内容类型："}),T((I=n.reportable)==null?void 0:I.type)]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"举报类型："}),y(n.type)]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"举报内容："}),n.content||"无"]}),n.description&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"详细描述："}),n.description]}),((A=n.reportable)==null?void 0:A.content)&&e.jsxs("div",{children:[e.jsx("strong",{children:"被举报内容："}),e.jsx("div",{style:{marginTop:4,padding:8,background:"#fff",border:"1px solid #d9d9d9",borderRadius:4},children:n.reportable.content})]})]})]}),e.jsx(m.Item,{label:"处理备注",name:"remark",rules:[{required:o==="rejected",message:"拒绝举报时必须填写处理备注"},{max:500,message:"备注不能超过500个字符"}],children:e.jsx(ee,{rows:4,placeholder:"请输入处理备注（拒绝举报时必填）",showCount:!0,maxLength:500})}),e.jsx(m.Item,{style:{marginBottom:0,textAlign:"right"},children:e.jsxs(j,{children:[e.jsx(h,{onClick:()=>{x(!1),u(null),p.resetFields()},children:"取消"}),e.jsx(h,{type:"primary",htmlType:"submit",loading:r,danger:o==="rejected",children:o==="handled"?"处理举报":"拒绝举报"})]})})]})})]})};export{le as default};
