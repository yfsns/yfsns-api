import{j as e}from"./index-C42INjwk.js";import{r as y,f as ye,j as be}from"./react-vendor-CKx6dMfn.js";import{v as w,ah as T,I as S,B as v,ai as ve,Q as te,o as I,G as re,Z as we,s as g,x as ne,aj as ke,K as ae,F as E,S as P,q as fe,O as Ce,r as Se,z as Fe,w as Te,T as oe,ak as Ne,u as X,a3 as Ie,a4 as _e,h as Pe,i as D,H as $e,J as ze,$ as Be,a7 as Re}from"./antd-vendor-DaJANQRB.js";import{p as z,a as Oe}from"./usePluginManagement-Ct7hxFZi.js";import"./redux-vendor-DakFfX2h.js";import"./index-CPCCNLS5.js";const ee=({field:s,value:l,error:o,onChange:h})=>{var n;return e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{children:[s.label,s.required&&e.jsx("span",{style:{color:"red"},children:"*"}),s.description&&e.jsx(w,{title:s.description,children:e.jsx(T,{style:{color:"#999"}})})]}),e.jsx(S,{value:l,placeholder:s.placeholder,onChange:d=>h(d.target.value),maxLength:(n=s.validation)==null?void 0:n.maxLength,style:{width:"100%"},status:o?"error":void 0}),o&&e.jsx("div",{className:"field-error",children:o})]})},Le=({field:s,value:l,error:o,onChange:h})=>{var m;const[n,d]=y.useState(!1);return e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{children:[s.label,s.required&&e.jsx("span",{style:{color:"red"},children:"*"}),s.description&&e.jsx(w,{title:s.description,children:e.jsx(T,{style:{color:"#999"}})})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(S,{type:n?"text":"password",value:l,placeholder:s.placeholder,onChange:i=>h(i.target.value),maxLength:(m=s.validation)==null?void 0:m.maxLength,style:{width:"100%",paddingRight:"40px"},status:o?"error":void 0}),e.jsx(v,{type:"text",icon:n?e.jsx(ve,{}):e.jsx(te,{}),onClick:()=>d(!n),style:{position:"absolute",right:"5px",top:"50%",transform:"translateY(-50%)",border:"none",padding:"4px",height:"auto"}})]}),o&&e.jsx("div",{className:"field-error",children:o})]})},{Option:qe}=I,Ae=({field:s,value:l,error:o,onChange:h})=>{var n;return e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{children:[s.label,s.required&&e.jsx("span",{style:{color:"red"},children:"*"}),s.description&&e.jsx(w,{title:s.description,children:e.jsx(T,{style:{color:"#999"}})})]}),e.jsx(I,{value:l,placeholder:s.placeholder||"è¯·é€‰æ‹©...",onChange:h,style:{width:"100%"},status:o?"error":void 0,children:(n=s.options)==null?void 0:n.map(d=>e.jsx(qe,{value:d.value,children:d.label},d.value))}),o&&e.jsx("div",{className:"field-error",children:o})]})},Me=({field:s,value:l,error:o,onChange:h})=>e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx(re,{checked:l,onChange:h,checkedChildren:"æ˜¯",unCheckedChildren:"å¦"}),e.jsxs("span",{style:{marginLeft:"8px"},children:[s.label,s.description&&e.jsx(w,{title:s.description,children:e.jsx(T,{style:{color:"#999",marginLeft:"4px"}})})]})]}),o&&e.jsx("div",{className:"field-error",children:o})]}),De=({field:s,value:l,error:o,onChange:h})=>{var n,d;return e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{children:[s.label,s.required&&e.jsx("span",{style:{color:"red"},children:"*"}),s.description&&e.jsx(w,{title:s.description,children:e.jsx(T,{style:{color:"#999"}})})]}),e.jsx(we,{value:l,placeholder:s.placeholder,onChange:h,min:(n=s.validation)==null?void 0:n.min,max:(d=s.validation)==null?void 0:d.max,step:s.step||1,style:{width:"100%"},status:o?"error":void 0}),o&&e.jsx("div",{className:"field-error",children:o})]})},{TextArea:Ee}=S,Je=({field:s,value:l,error:o,onChange:h})=>{var n,d;return e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{children:[s.label,s.required&&e.jsx("span",{style:{color:"red"},children:"*"}),s.description&&e.jsx(w,{title:s.description,children:e.jsx(T,{style:{color:"#999"}})})]}),e.jsx(Ee,{value:l,placeholder:s.placeholder,onChange:m=>h(m.target.value),rows:4,maxLength:(n=s.validation)==null?void 0:n.maxLength,showCount:!!((d=s.validation)!=null&&d.maxLength),style:{width:"100%"},status:o?"error":void 0}),o&&e.jsx("div",{className:"field-error",children:o})]})},{TextArea:Ke}=S,Ve=({field:s,value:l,error:o,onChange:h})=>{const n=i=>{try{const c=JSON.parse(i);return JSON.stringify(c,null,2)}catch{return i}},d=i=>{const c=i.target.value;h(c)},m=()=>{if(l)try{const i=n(l);i!==l&&h(i)}catch{}};return e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{children:[s.label,s.required&&e.jsx("span",{style:{color:"red"},children:"*"}),s.description&&e.jsx(w,{title:s.description,children:e.jsx(T,{style:{color:"#999"}})})]}),e.jsx(Ke,{value:l,placeholder:s.placeholder,onChange:d,onBlur:m,rows:6,style:{width:"100%",fontFamily:'Monaco, Menlo, "Ubuntu Mono", monospace',fontSize:"12px"},status:o?"error":void 0}),o&&e.jsx("div",{className:"field-error",children:o})]})},Ye=({field:s,pluginName:l,onActionExecuted:o})=>{const h=async()=>{if(!s.button_action){g.error("æŒ‰é’®æ“ä½œé…ç½®ä¸å®Œæ•´");return}s.button_confirm?ne.confirm({title:"ç¡®è®¤æ“ä½œ",icon:e.jsx(ke,{}),content:s.button_confirm,onOk:async()=>{await n()}}):await n()},n=async()=>{if(!s.button_action){g.error("æŒ‰é’®æ“ä½œé…ç½®ä¸å®Œæ•´");return}try{const i=await z.executeButtonAction(l,{action:s.button_action,config_key:s.key});i.success?(g.success(i.message),o==null||o(s.button_action,i.data)):g.error(i.message||"æ“ä½œå¤±è´¥")}catch(i){console.error("Button action error:",i),g.error("æ“ä½œæ‰§è¡Œå¤±è´¥")}},d=i=>{switch(i){case"primary":return"primary";case"danger":return"primary";case"success":case"warning":case"info":return"default";default:return"default"}},m=i=>i==="danger";return e.jsxs("div",{className:"form-field",children:[e.jsx(v,{type:d(s.button_variant),danger:m(s.button_variant),disabled:s.button_disabled,onClick:h,loading:!1,children:s.label}),s.description&&e.jsx("div",{className:"field-description",children:s.description})]})},{Text:Ge}=oe,{Option:B}=I,{confirm:se}=ne,He=({editing:s,dataIndex:l,title:o,inputType:h,record:n,index:d,children:m,options:i,...c})=>{const u=h==="number"?e.jsx(S,{type:"number"}):h==="select"?e.jsx(I,{children:i==null?void 0:i.map(x=>e.jsx(B,{value:x.value,children:x.label},x.value))}):e.jsx(S,{});return e.jsx("td",{...c,children:s?e.jsx(E.Item,{name:l,style:{margin:0},rules:[{required:!0,message:`è¯·è¾“å…¥ ${o}!`}],children:u}):m})},Qe=({field:s,pluginName:l})=>{var V,Y,G,H,Q,U,W,Z;if(!s.columns||s.columns.length===0)return console.error("DataTableField: No columns configured",s),e.jsx("div",{className:"data-table-field",children:e.jsx(ae,{message:"é…ç½®é”™è¯¯",description:"æ•°æ®è¡¨æ ¼ç¼ºå°‘åˆ—é…ç½®ä¿¡æ¯",type:"error",showIcon:!0})});const[o,h]=y.useState([]),[n,d]=y.useState(!1),[m,i]=y.useState(0),[c,u]=y.useState(1),[x,C]=y.useState(((V=s.pagination)==null?void 0:V.defaultPageSize)||10),[N,R]=y.useState(""),[b,k]=y.useState((Y=s.default_sort)==null?void 0:Y.field),[O,le]=y.useState(((G=s.default_sort)==null?void 0:G.order)==="asc"?"asc":"desc"),[J,ie]=y.useState({}),[L,q]=y.useState(""),[A]=E.useForm(),$=s.key,ce=(t,r)=>{var a;if(t==null)return"-";switch(r.type){case"badge":const j=(a=r.options)==null?void 0:a.find(f=>f.value===t);return j?e.jsx(X,{color:j.color||"default",children:j.label}):e.jsx(X,{children:String(t)});case"switch":return e.jsx(re,{checked:!!t,disabled:!0});case"datetime":try{return Ne(t).format("YYYY-MM-DD HH:mm:ss")}catch{return String(t)}case"textarea":return e.jsx(Ge,{ellipsis:{tooltip:String(t)},style:{maxWidth:200},children:String(t)});case"number":return Number(t).toLocaleString();case"text":default:return String(t)}},F=async(t={})=>{d(!0);try{const r={page:c,page_size:x,search:N,sort_field:b,sort_order:O,...J,...t},a=await z.getDataTableData(l,$,r);if(a&&typeof a=="object"){if("success"in a&&!a.success){g.error(a.message||"è·å–æ•°æ®å¤±è´¥");return}const j=a.data||[],f=a.total||0,p=a.page||1,_=a.page_size||10;Array.isArray(j)?(h(j),i(typeof f=="number"?f:0),u(typeof p=="number"?p:1),C(typeof _=="number"?_:10)):g.error("æ•°æ®æ ¼å¼é”™è¯¯ï¼šè¿”å›çš„æ•°æ®ä¸æ˜¯æ•°ç»„")}else g.error("APIå“åº”æ ¼å¼é”™è¯¯")}catch(r){console.error("Load data error:",r),g.error("è·å–æ•°æ®å¤±è´¥")}finally{d(!1)}};y.useEffect(()=>{F()},[l,$]);const de=(t,r,a)=>{const j=t.current,f=t.pageSize,p=a.field,_=a.order==="ascend"?"asc":"desc";u(j),C(f),k(p),le(_),F({page:j,page_size:f,sort_field:p,sort_order:_})},ue=t=>{R(t),u(1),F({search:t,page:1})},M=(t,r)=>{const a={...J,[t]:r};ie(a),u(1),F({...a,page:1})},he=t=>{A.setFieldsValue({...t}),q(t.id)},xe=()=>{q("")},pe=async t=>{try{const r=await A.validateFields(),a=typeof t=="bigint"?Number(t):t,j=await z.updateDataTableRecord(l,$,a,r);j.success?(g.success(j.message||"æ›´æ–°æˆåŠŸ"),q(""),F()):g.error(j.message||"æ›´æ–°å¤±è´¥")}catch(r){console.log("Validate Failed:",r)}},me=t=>{se({title:"ç¡®è®¤åˆ é™¤",content:"ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ",onOk:async()=>{try{const r=await z.deleteDataTableRecord(l,$,t.id);r.success?(g.success(r.message||"åˆ é™¤æˆåŠŸ"),F()):g.error(r.message||"åˆ é™¤å¤±è´¥")}catch{g.error("åˆ é™¤å¤±è´¥")}}})},K=(t,r)=>{t.confirm?se({title:"ç¡®è®¤æ“ä½œ",content:t.confirm,onOk:async()=>{g.info(`æ‰§è¡Œæ“ä½œ: ${t.label}`)}}):g.info(`æ‰§è¡Œæ“ä½œ: ${t.label}`)},je=()=>{if(!s.columns||s.columns.length===0)return[];const t=s.columns.map(r=>({title:r.label||r.title,dataIndex:r.dataIndex||r.key,key:r.key,width:r.width,align:r.align,sorter:r.sorter,render:(a,j)=>{if(!(L===j.id&&r.editable))return ce(a,r)},onCell:a=>({record:a,inputType:r.type==="number"?"number":"text",dataIndex:r.dataIndex||r.key,title:r.label||r.title,editing:L===a.id&&r.editable})}));return s.actions&&s.actions.length>0&&t.push({title:"æ“ä½œ",key:"action",width:200,render:(r,a)=>{var f;return L===a.id?e.jsxs("span",{children:[e.jsx(v,{type:"link",onClick:()=>pe(a.id),style:{marginRight:8},children:"ä¿å­˜"}),e.jsx(v,{type:"link",onClick:xe,children:"å–æ¶ˆ"})]}):e.jsx(P,{size:"middle",children:(f=s.actions)==null?void 0:f.map(p=>{switch(p.type){case"edit":return e.jsx(w,{title:p.label,children:e.jsx(v,{type:"link",icon:e.jsx(Te,{}),onClick:()=>he(a)})},p.key);case"delete":return e.jsx(w,{title:p.label,children:e.jsx(v,{type:"link",danger:p.danger,icon:e.jsx(Fe,{}),onClick:()=>me(a)})},p.key);case"view":return e.jsx(w,{title:p.label,children:e.jsx(v,{type:"link",icon:e.jsx(te,{}),onClick:()=>K(p)})},p.key);case"custom":return e.jsx(w,{title:p.label,children:e.jsx(v,{type:"link",onClick:()=>K(p),children:p.label})},p.key);default:return null}})})}}),t},ge=()=>!s.filters||s.filters.length===0?null:e.jsx(P,{style:{marginBottom:16},children:s.filters.map(t=>{var r;switch(t.type){case"input":return e.jsx(S,{placeholder:t.label,onPressEnter:a=>M(t.key,a.target.value),style:{width:200}},t.key);case"select":return e.jsx(I,{placeholder:t.label,onChange:a=>M(t.key,a),style:{width:200},children:(r=t.options)==null?void 0:r.map(a=>e.jsx(B,{value:a.value,children:a.label},a.value))},t.key);case"boolean":return e.jsxs(I,{placeholder:t.label,onChange:a=>M(t.key,a),style:{width:200},children:[e.jsx(B,{value:1,children:"æ˜¯"}),e.jsx(B,{value:0,children:"å¦"})]},t.key);default:return null}})});return e.jsxs("div",{className:"data-table-field",children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs(P,{children:[e.jsx(S,{placeholder:String(((H=s.search)==null?void 0:H.placeholder)??"æœç´¢..."),prefix:e.jsx(fe,{}),onPressEnter:t=>ue(t.target.value),style:{width:200}}),e.jsx(v,{icon:e.jsx(Ce,{}),onClick:()=>F(),children:"åˆ·æ–°"})]})}),ge(),e.jsx(E,{form:A,component:!1,children:e.jsx(Se,{components:{body:{cell:He}},columns:je(),dataSource:o,rowKey:"id",loading:n,pagination:{current:c,pageSize:x,total:m,pageSizeOptions:((Q=s.pagination)==null?void 0:Q.page_size_options)||[10,20,50],showSizeChanger:((U=s.pagination)==null?void 0:U.showSizeChanger)!==!1,showQuickJumper:((W=s.pagination)==null?void 0:W.showQuickJumper)!==!1,showTotal:((Z=s.pagination)==null?void 0:Z.showTotal)!==!1?(t,r)=>`ç¬¬ ${r[0]}-${r[1]} æ¡ï¼Œå…± ${t} æ¡`:void 0},onChange:de,size:"middle"})}),s.description&&e.jsx("div",{className:"field-description",style:{marginTop:8},children:s.description})]})},Ue=({group:s,fields:l,values:o,errors:h,onFieldChange:n,pluginName:d=""})=>{const m=c=>{const u=c.name||c.key,x={field:c,value:o[u],error:h[u]||void 0,onChange:C=>n(u,C)};switch(c.type){case"text":case"string":return e.jsx(ee,{...x},u);case"password":return e.jsx(Le,{...x},u);case"select":return e.jsx(Ae,{...x},u);case"boolean":return e.jsx(Me,{...x},u);case"number":return e.jsx(De,{...x},u);case"textarea":return e.jsx(Je,{...x},u);case"json":return e.jsx(Ve,{...x},u);case"button":return e.jsx(Ye,{field:c,pluginName:d,onActionExecuted:(C,N)=>{console.log("Button action executed:",C,N)}},u);case"data_table":return e.jsx("div",{style:{marginBottom:"16px"},children:e.jsx(Qe,{field:c,pluginName:d})},u);default:return console.warn(`ğŸ”§ [PluginConfig] Unsupported field type: ${c.type}, using TextField as fallback`),e.jsx(ee,{...x},u)}},i=[...l].sort((c,u)=>(c.order||0)-(u.order||0));return e.jsxs("div",{children:[s.description&&e.jsx("div",{style:{marginBottom:"24px",color:"#666",fontSize:"14px",padding:"16px",backgroundColor:"#f9f9f9",borderRadius:"6px"},children:s.description}),e.jsx(Ie,{gutter:16,children:i.map(c=>{const u=c.name||c.key,x=c.type==="textarea"||c.type==="json"||c.type==="data_table";return c.type==="data_table"?m(c):e.jsx(_e,{span:x?24:12,children:m(c)},`field-${s.key}-${u}`)})})]})},{Title:We,Text:ns}=oe,as=()=>{const s=ye(),{pluginName:l}=be(),{loading:o,saving:h,configData:n,formValues:d,errors:m,hasChanges:i,saveConfig:c,updateFormValue:u}=Oe(l||""),x=y.useMemo(()=>b=>{if(!(n!=null&&n.groups))return[];const k=n.groups.find(O=>O.key===b);return(k==null?void 0:k.configs)||[]},[n==null?void 0:n.groups]),C=y.useCallback((b,k)=>{u(b,k)},[u]),N=y.useMemo(()=>!(n!=null&&n.groups)||n.groups.length===0?[]:n.groups.map(b=>{const k=x(b.key);return k.length===0?null:{key:b.key,label:b.label,children:e.jsx(Ue,{group:b,fields:k,values:d,errors:m,onFieldChange:C,pluginName:l})}}).filter(b=>b!==null),[n==null?void 0:n.groups,d,m,C,l]),R=()=>{s("/plugin/list")};return o?e.jsxs("div",{style:{textAlign:"center",padding:"50px"},children:[e.jsx(Pe,{size:"large"}),e.jsx("div",{style:{marginTop:"16px"},children:"åŠ è½½æ’ä»¶é…ç½®ä¸­..."})]}):e.jsxs("div",{children:[e.jsx(D,{style:{marginBottom:16},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(P,{children:[e.jsx(v,{icon:e.jsx($e,{}),onClick:R,children:"è¿”å›æ’ä»¶åˆ—è¡¨"}),e.jsx(ze,{type:"vertical"}),e.jsx("div",{children:e.jsxs(We,{level:4,style:{margin:0},children:[l,"é…ç½®"]})})]}),e.jsx(P,{children:e.jsx(v,{type:"primary",icon:e.jsx(Be,{}),onClick:c,loading:h,disabled:!i,children:"ä¿å­˜é…ç½®"})})]})}),N.length>0?e.jsx(D,{children:e.jsx(Re,{items:N,type:"card",size:"large",tabPosition:"top"})}):e.jsx(D,{children:e.jsx(ae,{message:"æ’ä»¶é…ç½®",description:"æ­¤æ’ä»¶æš‚æ— é…ç½®é¡¹",type:"info",showIcon:!0})})]})};export{as as default};
