import{r as t,R as ie}from"./react-vendor-CKx6dMfn.js";import{i as _,j as e}from"./index-CfjFDGFk.js";import{s as o,F as C,W as ce,B as H,X as oe,G as P,k as ae,Y as re,o as ue,Z as de,I as Z,S as le,$ as he,J as ge,x as pe,u as fe,a0 as ye,a1 as xe,v as me,a2 as be}from"./antd-vendor-DaJANQRB.js";const S={fetchList:async l=>{const d={page:l.page,perPage:l.perPage,type:l.type,status:l.status,keyword:l.keyword,startDate:l.startDate,endDate:l.endDate,sortField:l.sortField,sortOrder:l.sortOrder},f=(await _.get("/api/admin/post/",{params:d})).data;return{list:f.data||[],total:f.total||0,page:f.page||f.current_page||1,per_page:f.per_page||10,last_page:f.last_page||1,from:f.from||0,to:f.to||0}},fetchDetail:async l=>_.get(`/api/admin/post/${l}`).then(d=>d.data),create:async l=>_.post("/api/admin/post/",l).then(d=>d.data),update:async(l,d)=>_.put(`/api/admin/post/${l}`,d).then(r=>r.data),delete:async l=>{await _.delete(`/api/admin/post/${l}`)},review:async(l,d)=>_.post(`/api/admin/review/manual/${l}`,{content_type:"post",status:d.status,remark:d.remark}).then(r=>r.data),batchDelete:async l=>{await _.post("/api/admin/post/batch-delete",{ids:l})}},ke=()=>{const[l,d]=t.useState(!1),[r,f]=t.useState([]),[D,k]=t.useState(0),c=t.useCallback(async(i={})=>{var h,n;d(!0);try{const s=await S.fetchList({...i,type:"image"});f(s.list||[]),k(s.total||0)}catch(s){console.error("获取图片动态列表失败:",s),o.error(((n=(h=s==null?void 0:s.response)==null?void 0:h.data)==null?void 0:n.message)||"获取数据失败"),f([]),k(0)}finally{d(!1)}},[]),[w,x]=t.useState(!1),[j,v]=t.useState(!1),[M,b]=t.useState(!1),[g,R]=t.useState(!1),[m,u]=t.useState(null),[a,p]=t.useState(!1),[T,B]=t.useState(!1),[E,F]=t.useState(null),[z,A]=t.useState(!1),U=t.useCallback(async i=>{var h,n;x(!0);try{await S.delete(i),o.success("删除成功"),c()}catch(s){o.error(((n=(h=s==null?void 0:s.response)==null?void 0:h.data)==null?void 0:n.message)||"删除失败")}finally{x(!1)}},[c]),$=t.useCallback(async i=>{var h,n;if(!i||i.length===0){o.warning("请选择要删除的项目");return}v(!0);try{await S.batchDelete(i),o.success(`成功删除 ${i.length} 条图片动态`),c()}catch(s){o.error(((n=(h=s==null?void 0:s.response)==null?void 0:h.data)==null?void 0:n.message)||"批量删除失败")}finally{v(!1)}},[c]),V=t.useCallback(i=>{i?(u(i),p(!0)):(u(null),p(!1)),R(!0)},[]),W=t.useCallback(()=>{R(!1),u(null),p(!1)},[]),G=t.useCallback(async i=>{var h,n;b(!0);try{a&&m?(await S.update(m.id,{...i,type:"image"}),o.success("图片动态更新成功")):(await S.create({...i,type:"image"}),o.success("图片动态创建成功")),R(!1),u(null),p(!1),c()}catch(s){o.error(((n=(h=s==null?void 0:s.response)==null?void 0:h.data)==null?void 0:n.message)||(a?"更新失败":"创建失败"))}finally{b(!1)}},[a,m,c]),N=t.useCallback(i=>{F(i),B(!0)},[]),J=t.useCallback(()=>{B(!1),F(null)},[]),q=t.useCallback(async i=>{var h,n;if(E){A(!0);try{await S.review(E.id,i),o.success("审核完成"),B(!1),F(null),c()}catch(s){o.error(((n=(h=s==null?void 0:s.response)==null?void 0:h.data)==null?void 0:n.message)||"审核失败")}finally{A(!1)}}},[E,c]);return{loading:l,posts:r,total:D,editModalVisible:g,editingRecord:m,isEditing:a,reviewModalVisible:T,reviewingRecord:E,fetchData:c,handleDelete:U,handleBatchDelete:$,handleEdit:V,handleCloseModal:W,handleSubmit:G,handleReview:N,handleCloseReviewModal:J,handleReviewSubmit:q,deleteLoading:w,batchDeleteLoading:j,submitLoading:M,reviewLoading:z}},Re=()=>{const[l,d]=t.useState(!1),[r,f]=t.useState([]),[D,k]=t.useState(0),c=t.useCallback(async(i={})=>{var h,n;d(!0);try{const s=await S.fetchList({...i,type:"video"});f(s.list||[]),k(s.total||0)}catch(s){console.error("获取视频动态列表失败:",s),o.error(((n=(h=s==null?void 0:s.response)==null?void 0:h.data)==null?void 0:n.message)||"获取数据失败"),f([]),k(0)}finally{d(!1)}},[]),[w,x]=t.useState(!1),[j,v]=t.useState(!1),[M,b]=t.useState(!1),[g,R]=t.useState(!1),[m,u]=t.useState(null),[a,p]=t.useState(!1),[T,B]=t.useState(!1),[E,F]=t.useState(null),[z,A]=t.useState(!1),U=t.useCallback(async i=>{var h,n;x(!0);try{await S.delete(i),o.success("删除成功"),c()}catch(s){o.error(((n=(h=s==null?void 0:s.response)==null?void 0:h.data)==null?void 0:n.message)||"删除失败")}finally{x(!1)}},[c]),$=t.useCallback(async i=>{var h,n;if(!i||i.length===0){o.warning("请选择要删除的项目");return}v(!0);try{await S.batchDelete(i),o.success(`成功删除 ${i.length} 条视频动态`),c()}catch(s){o.error(((n=(h=s==null?void 0:s.response)==null?void 0:h.data)==null?void 0:n.message)||"批量删除失败")}finally{v(!1)}},[c]),V=t.useCallback(i=>{i?(u(i),p(!0)):(u(null),p(!1)),R(!0)},[]),W=t.useCallback(()=>{R(!1),u(null),p(!1)},[]),G=t.useCallback(async i=>{var h,n;b(!0);try{a&&m?(await S.update(m.id,{...i,type:"video"}),o.success("视频动态更新成功")):(await S.create({...i,type:"video"}),o.success("视频动态创建成功")),R(!1),u(null),p(!1),c()}catch(s){o.error(((n=(h=s==null?void 0:s.response)==null?void 0:h.data)==null?void 0:n.message)||(a?"更新失败":"创建失败"))}finally{b(!1)}},[a,m,c]),N=t.useCallback(i=>{F(i),B(!0)},[]),J=t.useCallback(()=>{B(!1),F(null)},[]),q=t.useCallback(async i=>{var h,n;if(E){A(!0);try{await S.review(E.id,i),o.success("审核完成"),B(!1),F(null),c()}catch(s){o.error(((n=(h=s==null?void 0:s.response)==null?void 0:h.data)==null?void 0:n.message)||"审核失败")}finally{A(!1)}}},[E,c]);return{loading:l,posts:r,total:D,editModalVisible:g,editingRecord:m,isEditing:a,reviewModalVisible:T,reviewingRecord:E,fetchData:c,handleDelete:U,handleBatchDelete:$,handleEdit:V,handleCloseModal:W,handleSubmit:G,handleReview:N,handleCloseReviewModal:J,handleReviewSubmit:q,deleteLoading:w,batchDeleteLoading:j,submitLoading:M,reviewLoading:z}},Ce=()=>{const[l,d]=t.useState(!1),[r,f]=t.useState([]),[D,k]=t.useState(0),c=t.useCallback(async(n={})=>{var s,L;d(!0);try{const y=await S.fetchList({...n,type:"post"});f(y.list||[]),k(y.total||0)}catch(y){console.error("获取普通动态列表失败:",y),o.error(((L=(s=y==null?void 0:y.response)==null?void 0:s.data)==null?void 0:L.message)||"获取数据失败"),f([]),k(0)}finally{d(!1)}},[]),[w,x]=t.useState(!1),[j,v]=t.useState(!1),[M,b]=t.useState(!1),[g,R]=t.useState(!1),[m,u]=t.useState(null),[a,p]=t.useState(!1),T=t.useCallback(async n=>{var s,L;x(!0);try{await S.delete(n),o.success("删除成功"),await c()}catch(y){o.error(((L=(s=y==null?void 0:y.response)==null?void 0:s.data)==null?void 0:L.message)||"删除失败")}finally{x(!1)}},[c]),B=t.useCallback(async n=>{var s,L;if(!n||n.length===0){o.warning("请选择要删除的记录");return}v(!0);try{await S.batchDelete(n),o.success("批量删除成功"),await c()}catch(y){o.error(((L=(s=y==null?void 0:y.response)==null?void 0:s.data)==null?void 0:L.message)||"批量删除失败")}finally{v(!1)}},[c]),E=t.useCallback(n=>{n?(u(n),p(!0)):(u(null),p(!1)),R(!0)},[]),F=t.useCallback(()=>{R(!1),u(null),p(!1)},[]),z=t.useCallback(async n=>{var s,L,y,Y,ee,te,se;b(!0);try{a&&m?(await S.update(m.id,n),o.success("普通动态更新成功")):(await S.create({...n,type:"post"}),o.success("普通动态创建成功")),F(),await c()}catch(I){let X=(L=(s=I==null?void 0:I.response)==null?void 0:s.data)==null?void 0:L.message;const O=((ee=(Y=(y=I==null?void 0:I.response)==null?void 0:y.data)==null?void 0:Y.data)==null?void 0:ee.errors)||((se=(te=I==null?void 0:I.response)==null?void 0:te.data)==null?void 0:se.errors);if(O){const K=[];Object.keys(O).forEach(Q=>{Array.isArray(O[Q])?K.push(...O[Q]):K.push(O[Q])}),X=K.join("; ")||X||JSON.stringify(O)}X=X||(I==null?void 0:I.message)||(a?"更新失败":"创建失败"),o.error(X)}finally{b(!1)}},[a,m,c,F]),A=l||w||j||M,[U,$]=t.useState(!1),[V,W]=t.useState(null),[G,N]=t.useState(!1),J=t.useCallback(n=>{W(n),$(!0)},[]),q=t.useCallback(()=>{$(!1),W(null)},[]),i=t.useCallback(async n=>{var s,L;if(V){N(!0);try{await S.review(V.id,n),o.success("审核成功"),$(!1),W(null),await c()}catch(y){const Y=((L=(s=y==null?void 0:y.response)==null?void 0:s.data)==null?void 0:L.message)||(y==null?void 0:y.message)||"审核失败";o.error(Y)}finally{N(!1)}}},[V,c]);return{loading:A||G,posts:r,total:D,editModalVisible:g,editingRecord:m,isEditing:a,reviewModalVisible:U,reviewingRecord:V,fetchData:c,handleDelete:T,handleBatchDelete:B,handleEdit:E,handleCloseModal:F,handleSubmit:z,handleReview:J,handleCloseReviewModal:q,handleReviewSubmit:i}},ne=({type:l="input",inputProps:d,textareaProps:r,passwordProps:f,numberProps:D,selectProps:k,switchProps:c,checkboxProps:w,uploadProps:x,radioGroupProps:j,inline:v=!1,children:M,render:b,...g})=>{const R=C.useFormInstance();if(l==="upload"){let u="上传",a=x||{};if(x&&"buttonText"in x){u=x.buttonText;const{buttonText:p,...T}=x;a=T}return e.jsx(C.Item,{...g,getValueFromEvent:p=>Array.isArray(p)?p:p==null?void 0:p.fileList,getValueProps:p=>({fileList:p}),children:e.jsx(ce,{...a,children:e.jsx(H,{icon:e.jsx(oe,{}),children:u})})})}const m=()=>{switch(l){case"input":return e.jsx(Z,{...d});case"textarea":return e.jsx(Z.TextArea,{...r});case"password":return e.jsx(Z.Password,{...f});case"number":return e.jsx(de,{...D});case"select":return e.jsx(ue,{...k});case"switch":return e.jsx(P,{...c});case"checkbox":return e.jsx(ae,{...w});case"radio":return e.jsx(re.Group,{...j});case"custom":return typeof b=="function"?null:b??M;default:return M}};if(v&&l==="switch")return e.jsx(C.Item,{...g,label:null,style:{marginBottom:24},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx("span",{style:{width:"150px",minWidth:"150px",fontSize:"14px",color:"#333",fontWeight:500,textAlign:"left",paddingRight:"12px",lineHeight:"40px",height:"40px",display:"inline-block"},children:g.label}),e.jsx("div",{style:{flex:1},children:e.jsx(P,{...c})})]})});if(v){const u=l==="textarea";return e.jsx(C.Item,{...g,label:null,style:{marginBottom:24},children:e.jsxs("div",{style:{display:"flex",alignItems:u?"flex-start":"center",width:"100%"},children:[e.jsx("span",{style:{width:"150px",minWidth:"150px",fontSize:"14px",color:"#333",fontWeight:500,textAlign:"left",paddingRight:"12px",lineHeight:u?"24px":"40px",height:u?"24px":"40px",display:"inline-block",marginTop:u?"6px":0},children:g.label}),e.jsx("div",{style:{flex:1},children:m()})]})})}return l==="checkbox"?e.jsx(C.Item,{...g,label:null,valuePropName:"checked",style:{marginBottom:24},children:e.jsx(ae,{...w,children:g.label})}):l==="switch"?e.jsx(C.Item,{...g,label:null,style:{marginBottom:24},valuePropName:"checked",children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:500,color:"#333",marginRight:12},children:g.label}),e.jsx(P,{...c})]})}):v&&l==="custom"&&b?e.jsx(C.Item,{...g,label:null,style:{marginBottom:24},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx("span",{style:{width:"150px",minWidth:"150px",fontSize:"14px",color:"#333",fontWeight:500,textAlign:"left",paddingRight:"12px",lineHeight:"40px",height:"40px",display:"inline-block"},children:g.label}),e.jsx("div",{style:{flex:1},children:typeof b=="function"?b(R):b})]})}):e.jsx(C.Item,{...g,children:m()})};t.forwardRef(({fields:l,initialValues:d={},onFinish:r,onReset:f,loading:D=!1,submitText:k="保存设置",resetText:c="重置",showReset:w=!0,maxWidth:x=800,validateForm:j,extraButtons:v,form:M},b)=>{const[g]=C.useForm();t.useImperativeHandle(b,()=>g,[g]);const R=async a=>{j&&!await j(g)||r(a)},m=()=>{f?f():g.resetFields()},u=(a,p)=>a.divider?e.jsx(ge,{orientation:a.divider.orientation||"left",children:a.divider.title},`divider-${p}`):a.conditional?e.jsx(C.Item,{noStyle:!0,shouldUpdate:(T,B)=>T[a.conditional.field]!==B[a.conditional.field],children:({getFieldValue:T})=>T(a.conditional.field)===a.conditional.value?e.jsx(ne,{label:a.label,name:a.name,type:a.type,inline:a.inline,rules:a.rules,...a.props,render:a.type==="custom"&&typeof a.render=="function"?a.render(g):void 0},a.name):null},`${a.name}-${p}`):e.jsx(ne,{label:a.label,name:a.name,type:a.type,inline:a.inline,rules:a.rules,...a.props,render:a.type==="custom"&&typeof a.render=="function"?a.render(g):void 0},a.name);return e.jsxs(C,{form:M||g,layout:"vertical",initialValues:d,onFinish:R,style:{maxWidth:x},children:[l.map((a,p)=>u(a,p)),e.jsx(C.Item,{children:e.jsxs(le,{children:[e.jsx(H,{type:"primary",htmlType:"submit",icon:e.jsx(he,{}),loading:D,children:k}),w&&e.jsx(H,{onClick:m,children:c}),v]})})]})});const{TextArea:we}=Z,Le=({open:l,loading:d=!1,record:r,onApprove:f,onReject:D,onCancel:k,showType:c=!1})=>{const[w]=C.useForm(),[x,j]=ie.useState(!1),v=()=>r&&(r.excerpt||r.content)||"",M=()=>r!=null&&r.author&&(r.author.nickname||r.author.username)||"-",b=u=>({article:"blue",post:"green",thread:"orange",comment:"purple"})[u||""]||"default",g=async()=>{try{const u=await w.validateFields();j(!0),await f({remark:u.remark}),w.resetFields()}catch{}finally{j(!1)}},R=async()=>{try{const u=await w.validateFields();j(!0),await D({remark:u.remark}),w.resetFields()}catch{}finally{j(!1)}},m=()=>{w.resetFields(),k()};return e.jsxs(pe,{title:"审核",open:l,onCancel:m,footer:null,width:600,children:[r&&e.jsxs("div",{style:{marginBottom:16},children:[c&&r.typeText&&e.jsxs("p",{style:{marginBottom:8},children:[e.jsx("strong",{children:"类型："}),e.jsx(fe,{color:b(r.type),style:{marginLeft:8},children:r.typeText})]}),r.title&&e.jsxs("p",{style:{marginBottom:8},children:[e.jsx("strong",{children:"标题："}),e.jsx("span",{children:r.title})]}),v()&&e.jsxs("p",{style:{marginBottom:8},children:[e.jsx("strong",{children:"内容："}),e.jsxs("span",{children:[v().substring(0,200),v().length>200&&"..."]})]}),r.author&&e.jsxs("p",{style:{marginBottom:0},children:[e.jsx("strong",{children:"作者："}),e.jsx("span",{children:M()})]})]}),e.jsx(C,{form:w,layout:"vertical",children:e.jsx(C.Item,{name:"remark",label:"审核备注",rules:[{max:500,message:"备注最多500个字符"}],children:e.jsx(we,{placeholder:"请输入审核备注（可选，最多500字）",rows:4,showCount:!0,maxLength:500})})}),e.jsx("div",{style:{textAlign:"right",marginTop:16},children:e.jsxs(le,{children:[e.jsx(H,{onClick:m,disabled:x||d,children:"取消"}),e.jsx(H,{danger:!0,icon:e.jsx(ye,{}),onClick:R,loading:x||d,children:"拒绝"}),e.jsx(H,{type:"primary",icon:e.jsx(xe,{}),onClick:g,loading:x||d,style:{background:"#52c41a",borderColor:"#52c41a"},children:"通过"})]})})]})},De=({record:l,isPending:d,onReview:r,size:f="small",showText:D=!0,style:k})=>(d?d(l):(x=>{const j=x==null?void 0:x.status;return j===0||j==="pending"})(l))?e.jsx(me,{title:"审核",children:e.jsx(H,{type:"link",icon:e.jsx(be,{}),onClick:()=>r(l),style:{padding:0,...k},size:f,children:D&&"审核"})}):null;export{De as R,Le as a,ke as b,Re as c,Ce as u};
