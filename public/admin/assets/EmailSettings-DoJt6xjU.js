import{i as c,j as e}from"./index-C42INjwk.js";import{r as x}from"./react-vendor-CKx6dMfn.js";import{s as w}from"./index-CPCCNLS5.js";import{s as E,F as t,i as q,I as m,a3 as T,a4 as d,Z as k,o as I,B as f,x as R}from"./antd-vendor-DaJANQRB.js";import"./redux-vendor-DakFfX2h.js";const b={async getConfig(){return(await c.get("/api/admin/email/configs")).data},async updateConfig(s){return c.post("/api/admin/email/configs",s)},async testSend(s){return c.post("/api/admin/email/test/send",s)},async testConfig(s){return c.post("/api/admin/email/configs/test",s)},async sendVerificationCode(s){return c.post("/api/admin/email/test/verification-code",s)},async checkVerificationCode(s){return c.post("/api/admin/email/test/check-code",s)}},A=s=>{const[i,l]=x.useState(!1),[n,r]=x.useState(!1),[u,y]=x.useState(null),[C,o]=x.useState(!1),j=async()=>{try{l(!0);const a=await b.getConfig();y(a),s.setFieldsValue({...a,password:""})}catch{w("获取邮件服务器配置失败")}finally{l(!1)}},p=async()=>{var a,h;try{const g=await s.validateFields();l(!0),await b.updateConfig(g),E.success("邮件配置已更新"),j()}catch(g){w(((h=(a=g==null?void 0:g.response)==null?void 0:a.data)==null?void 0:h.message)||"更新失败，请重试")}finally{l(!1)}},v=async a=>{try{const h=await a.validateFields();r(!0),await b.testConfig({testEmail:h.to_email}),E.success("测试邮件发送成功！"),o(!1),a.resetFields()}catch{w("测试邮件发送失败，请检查配置")}finally{r(!1)}},M=()=>{S()},S=()=>{o(!0)},V=a=>{o(!1),a.resetFields()};return x.useEffect(()=>{j()},[]),{loading:i,testing:n,emailConfigData:u,testModalVisible:C,updateConfig:p,testEmail:v,quickTest:M,showTestModal:S,hideTestModal:V}},{Option:F}=I,O=()=>{const[s]=t.useForm(),[i]=t.useForm(),{loading:l,testing:n,testModalVisible:r,updateConfig:u,quickTest:y,testEmail:C,hideTestModal:o}=A(s),j=p=>{p==="ssl"?s.setFieldsValue({port:465}):p==="tls"?s.setFieldsValue({port:587}):p==="none"&&s.setFieldsValue({port:25})};return e.jsxs("div",{style:{padding:"12px"},children:[e.jsx(q,{children:e.jsxs(t,{form:s,layout:"vertical",style:{maxWidth:800},initialValues:{encryption:"ssl",port:465},children:[e.jsx(t.Item,{name:"host",label:"主机",rules:[{required:!0,message:"请输入SMTP服务器地址"}],children:e.jsx(m,{placeholder:"例如：smtp.gmail.com"})}),e.jsxs(T,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(t.Item,{name:"port",label:"端口",rules:[{required:!0,message:"请输入SMTP端口"}],children:e.jsx(k,{min:1,max:65535,style:{width:"100%"},placeholder:"默认 465"})})}),e.jsx(d,{span:12,children:e.jsx(t.Item,{name:"encryption",label:"加密方式",children:e.jsxs(I,{placeholder:"请选择加密方式",onChange:j,children:[e.jsx(F,{value:"ssl",children:"SSL"}),e.jsx(F,{value:"tls",children:"TLS"}),e.jsx(F,{value:"none",children:"无"})]})})})]}),e.jsxs(T,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(t.Item,{name:"username",label:"邮箱账号",rules:[{required:!0,message:"请输入邮箱账号"}],children:e.jsx(m,{placeholder:"请输入邮箱账号"})})}),e.jsx(d,{span:12,children:e.jsx(t.Item,{name:"password",label:"邮箱密码",extra:"不修改密码可以留空",children:e.jsx(m.Password,{placeholder:"请输入邮箱密码",autoComplete:"new-password"})})})]}),e.jsxs(T,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(t.Item,{name:"fromAddress",label:"发件人邮箱",rules:[{required:!0,message:"请输入发件人邮箱"},{type:"email",message:"请输入有效的邮箱地址"}],children:e.jsx(m,{placeholder:"发件人邮箱"})})}),e.jsx(d,{span:12,children:e.jsx(t.Item,{name:"fromName",label:"发件人名称",rules:[{required:!0,message:"请输入发件人名称"}],children:e.jsx(m,{placeholder:"发件人名称"})})})]}),e.jsxs(t.Item,{style:{marginTop:"24px"},children:[e.jsx(f,{type:"primary",loading:l,onClick:u,size:"large",style:{marginRight:"12px"},children:"保存配置"}),e.jsx(f,{onClick:y,loading:n,size:"large",children:"发送测试"})]})]})}),e.jsx(R,{title:"发送测试邮件",open:r,onCancel:()=>o(i),footer:null,destroyOnClose:!0,children:e.jsx(B,{form:i,onTest:C,onCancel:o,testing:n})})]})},B=({form:s,onTest:i,onCancel:l,testing:n})=>{const r=async()=>{await i(s)},u=()=>{l(s)};return e.jsxs(t,{form:s,layout:"vertical",onFinish:r,children:[e.jsx(t.Item,{name:"to_email",label:"收件人邮箱",rules:[{required:!0,message:"请输入收件人邮箱"},{type:"email",message:"请输入有效的邮箱地址"}],children:e.jsx(m,{placeholder:"请输入要发送测试邮件的邮箱地址"})}),e.jsxs(t.Item,{style:{marginBottom:0,textAlign:"right"},children:[e.jsx(f,{onClick:u,style:{marginRight:8},children:"取消"}),e.jsx(f,{type:"primary",htmlType:"submit",loading:n,children:"发送测试邮件"})]})]})};export{O as default};
