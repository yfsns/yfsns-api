import{j as e}from"./index-CfjFDGFk.js";import{r as l,j as S,f as k,R as E}from"./react-vendor-CKx6dMfn.js";import{t as b}from"./templateApi-CLSff-sO.js";import{s as y}from"./index-CPCCNLS5.js";import{F as t,s as h,i as F,S as g,B as I,H as A,J as x,T as R,a3 as D,a4 as T,I as n,k as u,G as N,o as B}from"./antd-vendor-DaJANQRB.js";import"./redux-vendor-DakFfX2h.js";const G=a=>{const[s]=t.useForm(),[p,c]=l.useState(!1),[o,j]=l.useState(null),i=a!=="new"&&a!==void 0,d=l.useCallback(async r=>{c(!0);try{const m=await b.fetchDetail(r);return j(m),m}catch{return y("获取模板详情失败"),null}finally{c(!1)}},[]),f=l.useCallback(async()=>{if(i&&a){const r=await d(a);r&&s.setFieldsValue(r)}},[i,a,s,d]),v=l.useCallback(async r=>{try{return!i||!a?(y("模板只能通过数据库创建，不支持通过界面创建"),!1):(await b.update(a,r),!0)}catch{return y("保存失败，请重试"),!1}},[i,a]),w=l.useCallback(async()=>{try{const r=await s.validateFields();return await v(r)}catch{return!1}},[s,v]),C=l.useCallback(()=>{s.resetFields()},[s]);return l.useEffect(()=>{f()},[f]),{form:s,loading:p,currentTemplate:o,isEdit:i,handleSave:w,resetForm:C}},{Title:L,Text:M}=R,{Option:V}=B,{TextArea:J}=n,U=()=>{const{id:a}=S(),s=k(),{form:p,currentTemplate:c,isEdit:o,handleSave:j}=G(a);E.useEffect(()=>{a==="new"&&(h.warning("模板只能通过数据库创建，不支持通过界面创建"),s("/system/notification"))},[a,s]);const i=async()=>{if(!o){h.warning("模板只能通过数据库创建，不支持通过界面创建"),s("/system/notification");return}await j()?(h.success("模板更新成功"),s("/system/notification")):h.error("保存失败，请检查表单内容")},d=()=>{s("/system/notification")};return o?e.jsx("div",{style:{padding:"12px"},children:e.jsxs(F,{children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs(g,{children:[e.jsx(I,{icon:e.jsx(A,{}),onClick:d,children:"返回"}),e.jsx(x,{type:"vertical"}),e.jsx(L,{level:3,style:{margin:0},children:"编辑通知模板"})]}),e.jsxs(M,{type:"secondary",style:{display:"block",marginTop:"8px"},children:["编辑模板：",(c==null?void 0:c.name)||""]})]}),e.jsxs(t,{form:p,layout:"vertical",onFinish:i,children:[e.jsxs(D,{gutter:16,children:[e.jsx(T,{span:12,children:e.jsx(t.Item,{name:"name",label:"模板名称",rules:[{required:!0,message:"请输入模板名称"}],children:e.jsx(n,{placeholder:"如：注册通知、登录通知"})})}),e.jsx(T,{span:12,children:e.jsx(t.Item,{name:"code",label:"模板代码",rules:[{required:!0,message:"请输入模板代码"}],children:e.jsx(n,{placeholder:"如：USER_REGISTER, LOGIN_VERIFY"})})})]}),e.jsx(t.Item,{name:"description",label:"模板描述",children:e.jsx(n.TextArea,{rows:3,placeholder:"详细描述模板的用途和使用场景"})}),e.jsx(t.Item,{name:"channels",label:"通知渠道",children:e.jsx(u.Group,{children:e.jsxs(g,{size:"middle",children:[e.jsx(u,{value:"database",children:"数据库"}),e.jsx(u,{value:"mail",children:"邮件"}),e.jsx(u,{value:"sms",children:"短信"})]})})}),e.jsx(x,{orientation:"left",children:"模板内容配置"}),e.jsx(t.Item,{name:["content","database"],label:"数据库通知内容",extra:"数据库通知消息的内容，可使用 {变量名} 格式插入动态内容",children:e.jsx(n.TextArea,{rows:4,placeholder:"例如：欢迎 {username}，您的验证码是 {code}，请在5分钟内使用。"})}),e.jsx(t.Item,{name:["content","mail"],label:"邮件内容",extra:"邮件通知的内容，支持HTML格式，可使用 {变量名} 格式插入动态内容",children:e.jsx(n.TextArea,{rows:6,placeholder:"例如：<h3>欢迎 {username}</h3><p>您的验证码是：<strong>{code}</strong></p><p>请在5分钟内使用，请勿泄露给他人。</p>"})}),e.jsx(t.Item,{name:["content","sms"],label:"短信内容",extra:"短信通知内容，建议控制在70字以内，可使用 {变量名} 格式插入动态内容",children:e.jsx(n.TextArea,{rows:3,placeholder:"例如：欢迎 {username}，您的验证码是 {code}，请在5分钟内使用。",maxLength:70,showCount:!0})}),e.jsx(t.Item,{name:"smsTemplateId",label:"短信模板ID",extra:"短信服务商提供的模板ID，用于发送短信（短信特有字段）",children:e.jsx(n,{placeholder:"请输入短信模板ID，例如：SMS_123456789"})}),e.jsx(x,{orientation:"left",children:"高级配置"}),e.jsx(t.Item,{name:"variables",label:"模板变量",extra:"定义模板中可用的变量名，多个用英文逗号分隔",children:e.jsx(n.TextArea,{rows:3,placeholder:"例如：username,code,time,email"})}),e.jsx(t.Item,{name:"status",label:"启用状态",valuePropName:"checked",extra:"禁用后该模板将不会发送通知",children:e.jsx(N,{checkedChildren:"启用",unCheckedChildren:"禁用"})}),e.jsx(x,{}),e.jsx("div",{style:{textAlign:"left"},children:e.jsx(I,{type:"primary",htmlType:"submit",children:"保存"})})]})]})}):null};export{U as default};
