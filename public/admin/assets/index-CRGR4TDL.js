import{i as v,j as e}from"./index-CfjFDGFk.js";import{r as c}from"./react-vendor-CKx6dMfn.js";import{s as x,F as g,S as b,i as V,I as E,o as q,B as j,q as Q,O,r as J,x as N,v as T,A as U,u as W,a1 as G,a0 as H,Q as X,P as Y,z as Z}from"./antd-vendor-DaJANQRB.js";import"./redux-vendor-DakFfX2h.js";const I={getStatistics:async()=>(await v.get("/api/admin/comment/statistics")).data,getList:async(i={})=>{const d=(await v.get("/api/admin/comment",{params:i})).data;return{list:d.data||[],total:d.total||0,page:d.page||d.current_page||1,perPage:d.per_page||10,lastPage:d.last_page||1,hasMore:d.has_more||!1}},getDetail:async i=>(await v.get(`/api/admin/comment/${i}`)).data,updateStatus:async(i,r)=>(await v.put(`/api/admin/comment/${i}/status`,r)).data,auditComment:async(i,r)=>(await v.put(`/api/admin/comment/${i}/audit`,r)).data,deleteComment:async i=>(await v.delete(`/api/admin/comment/${i}`)).data,batchAudit:async i=>(await v.post("/api/admin/comment/batch-audit",i)).data,batchDelete:async i=>(await v.post("/api/admin/comment/batch-destroy",i)).data},ee=()=>{const[i,r]=c.useState(!1),[d,D]=c.useState([]),[y,$]=c.useState(0),[B,F]=c.useState(null),[p,w]=c.useState(!1),[k,z]=c.useState(null),[f,R]=c.useState("approve"),[u,A]=c.useState([]),m=c.useCallback(async(a={})=>{var o,l;r(!0);try{const n=await I.getList(a);n.list?(D(n.list||[]),$(n.total||0)):(D([]),$(0))}catch(n){x.error(((l=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:l.message)||"è·å–è¯„è®ºåˆ—è¡¨å¤±è´¥")}finally{r(!1)}},[]),h=c.useCallback(async()=>{try{const a=await I.getStatistics();a&&F(a)}catch(a){console.error("è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥:",a)}},[]),M=c.useCallback((a,o)=>{z(a),R(o),w(!0)},[]),_=c.useCallback(async a=>{var o,l;if(k)try{r(!0);const n={status:f==="approve"?1:2,reason:f==="reject"?a.reason:void 0};await I.auditComment(k.id,n),x.success(`è¯„è®º${f==="approve"?"é€šè¿‡":"æ‹’ç»"}æˆåŠŸ`),await m(),await h(),w(!1),z(null)}catch(n){x.error(((l=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:l.message)||"æ“ä½œå¤±è´¥")}finally{r(!1)}},[k,f,m,h]),P=c.useCallback(async a=>{var o,l;try{r(!0),await I.deleteComment(a),x.success("è¯„è®ºåˆ é™¤æˆåŠŸ"),await m(),await h()}catch(n){x.error(((l=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:l.message)||"åˆ é™¤å¤±è´¥")}finally{r(!1)}},[m,h]),t=c.useCallback(async(a,o)=>{var l,n;if(u.length===0){x.warning("è¯·å…ˆé€‰æ‹©è¦å®¡æ ¸çš„è¯„è®º");return}try{r(!0);const S={ids:u,status:a==="approve"?1:2,reason:o};await I.batchAudit(S),x.success(`æˆåŠŸ${a==="approve"?"é€šè¿‡":"æ‹’ç»"} ${u.length} æ¡è¯„è®º`),await m(),await h(),A([])}catch(S){x.error(((n=(l=S==null?void 0:S.response)==null?void 0:l.data)==null?void 0:n.message)||"æ‰¹é‡å®¡æ ¸å¤±è´¥")}finally{r(!1)}},[u,m,h]),s=c.useCallback(async()=>{var a,o;if(u.length===0){x.warning("è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„è¯„è®º");return}try{r(!0);const l={ids:u};await I.batchDelete(l),x.success(`æˆåŠŸåˆ é™¤ ${u.length} æ¡è¯„è®º`),await m(),await h(),A([])}catch(l){x.error(((o=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:o.message)||"æ‰¹é‡åˆ é™¤å¤±è´¥")}finally{r(!1)}},[u,m,h]),C=c.useCallback(()=>{w(!1),z(null)},[]);return{loading:i,comments:d,total:y,statistics:B,reviewModalVisible:p,currentComment:k,reviewAction:f,selectedRowKeys:u,setSelectedRowKeys:A,fetchComments:m,fetchStatistics:h,handleReview:M,handleReviewSubmit:_,handleDelete:P,handleBatchAudit:t,handleBatchDelete:s,handleCloseReviewModal:C}},{Option:K}=q,{TextArea:te}=E,le=()=>{const[i]=g.useForm(),[r]=g.useForm(),[d,D]=c.useState({current:1,pageSize:10}),{loading:y,comments:$,total:B,reviewModalVisible:F,currentComment:p,reviewAction:w,selectedRowKeys:k,setSelectedRowKeys:z,fetchComments:f,handleReview:R,handleReviewSubmit:u,handleDelete:A,handleCloseReviewModal:m}=ee();c.useEffect(()=>{h({page:1,per_page:10})},[]);const h=async(t={})=>{await f(t)},M=async t=>{await h({...t,page:1,per_page:d.pageSize})},_=t=>{D(t),h({page:t.current,per_page:t.pageSize,...i.getFieldsValue()})},P=[{title:"ID",dataIndex:"id",key:"id",width:80,sorter:(t,s)=>t.id-s.id},{title:"è¯„è®ºå†…å®¹",dataIndex:"content",key:"content",width:250,render:(t,s)=>e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:4},children:e.jsx(T,{title:t,children:e.jsx("span",{style:{maxWidth:"220px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"inline-block"},children:t})})}),s.parentId&&e.jsxs("div",{style:{fontSize:"12px",color:"#999",marginTop:4},children:["å›å¤è¯„è®º (ID: ",s.parentId,")"]})]})},{title:"è¯„è®ºè€…",dataIndex:"user",key:"user",width:120,render:t=>e.jsxs(b,{children:[e.jsx(U,{size:"small",src:t.avatarUrl,icon:e.jsx("span",{style:{fontSize:"10px"},children:t.nickname.charAt(0)})}),e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsx("div",{children:t.nickname}),e.jsxs("div",{style:{color:"#999"},children:["@",t.username]})]})]})},{title:"æ‰€å±åŠ¨æ€",dataIndex:"targetType",key:"targetType",width:150,render:(t,s)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:"bold"},children:t==="post"?"åŠ¨æ€":t==="image"?"å›¾ç‰‡":t==="video"?"è§†é¢‘":t}),e.jsxs("div",{style:{fontSize:"11px",color:"#666"},children:["ID: ",s.targetId]})]})},{title:"ç‚¹èµ/å›å¤",key:"counts",width:100,render:(t,s)=>e.jsx("div",{style:{textAlign:"center"},children:e.jsxs("div",{style:{fontSize:"12px"},children:["ğŸ‘ ",s.likeCount," | ğŸ’¬ ",s.replyCount]})})},{title:"çŠ¶æ€",dataIndex:"status",key:"status",width:80,render:t=>e.jsx(W,{color:t===1?"green":t===2?"red":"orange",children:t===1?"å·²é€šè¿‡":t===2?"å·²æ‹’ç»":"å¾…å®¡æ ¸"})},{title:"å®¡æ ¸è®°å½•",width:250,render:(t,s)=>{const C=s.auditRecords;if(!C||!Array.isArray(C)||C.length===0)return s.status===0?e.jsx("span",{style:{color:"#999"},children:"-"}):e.jsx("span",{style:{color:"#999"},children:"æš‚æ— å®¡æ ¸è®°å½•"});const a=C[0],o=C.length,l=a.channelType||"manual",n=a.channel||(l==="ai"?"AI":"äººå·¥"),S=l==="ai"?"purple":"blue",L=a.reason||"";return e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsx("div",{style:{marginBottom:4},children:e.jsxs(b,{size:4,children:[e.jsxs(W,{color:S,style:{margin:0},children:[n,"å®¡æ ¸"]}),e.jsx("span",{style:{color:"#666"},children:o>1?`å…±${o}æ¬¡`:""})]})}),e.jsx("div",{style:{color:"#999",marginBottom:2},children:new Date(a.createdAt).toLocaleString("zh-CN")}),L&&e.jsxs("div",{style:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"#666"},children:["åŸå› : ",L]})]})}},{title:"è¯„è®ºæ—¶é—´",dataIndex:"createdAt",key:"createdAt",width:120,render:t=>e.jsxs("div",{style:{fontSize:"12px"},children:[t.split(" ")[0],e.jsx("br",{}),t.split(" ")[1]]})},{title:"æ“ä½œ",key:"action",width:150,render:(t,s)=>s.status===0?e.jsxs(b,{size:4,children:[e.jsx(T,{title:"é€šè¿‡è¯„è®º",children:e.jsx(j,{type:"link",size:"small",icon:e.jsx(G,{style:{color:"#52c41a"}}),onClick:()=>R(s,"approve"),disabled:y})}),e.jsx(T,{title:"æ‹’ç»è¯„è®º",children:e.jsx(j,{type:"link",size:"small",icon:e.jsx(H,{style:{color:"#ff4d4f"}}),onClick:()=>R(s,"reject"),disabled:y})})]}):e.jsxs(b,{size:4,children:[e.jsx(T,{title:"æŸ¥çœ‹è¯„è®º",children:e.jsx(j,{type:"link",icon:e.jsx(X,{}),onClick:()=>R(s,"approve"),disabled:y})}),e.jsx(Y,{title:"ç¡®å®šåˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿ",description:"åˆ é™¤åä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œ",onConfirm:()=>A(s.id),okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",children:e.jsx(T,{title:"åˆ é™¤è¯„è®º",children:e.jsx(j,{type:"link",danger:!0,icon:e.jsx(Z,{}),disabled:y})})})]})}];return e.jsxs("div",{style:{padding:"12px"},children:[e.jsxs(b,{direction:"vertical",size:16,style:{width:"100%"},children:[e.jsx(V,{size:"small",style:{marginBottom:"16px"},children:e.jsxs(g,{form:i,layout:"inline",onFinish:M,style:{marginBottom:0},children:[e.jsx(g.Item,{name:"keyword",label:"å…³é”®è¯",children:e.jsx(E,{placeholder:"è¯„è®ºå†…å®¹æˆ–ç”¨æˆ·å",style:{width:200}})}),e.jsx(g.Item,{name:"status",label:"çŠ¶æ€",children:e.jsxs(q,{placeholder:"é€‰æ‹©çŠ¶æ€",style:{width:120},allowClear:!0,children:[e.jsx(K,{value:0,children:"å¾…å®¡æ ¸"}),e.jsx(K,{value:1,children:"å·²é€šè¿‡"}),e.jsx(K,{value:2,children:"å·²æ‹’ç»"})]})}),e.jsx(g.Item,{children:e.jsxs(b,{children:[e.jsx(j,{type:"primary",htmlType:"submit",icon:e.jsx(Q,{}),children:"æœç´¢"}),e.jsx(j,{icon:e.jsx(O,{}),onClick:()=>{i.resetFields(),h({page:1,perPage:d.pageSize})},children:"é‡ç½®"}),e.jsx(j,{icon:e.jsx(O,{}),onClick:()=>h({page:d.current,perPage:d.pageSize,...i.getFieldsValue()}),loading:y,children:"åˆ·æ–°"})]})})]})}),e.jsx(V,{children:e.jsx(J,{columns:P,dataSource:$,rowKey:"id",loading:y,rowSelection:{selectedRowKeys:k,onChange:z},pagination:{...d,total:B,showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,s)=>`ç¬¬ ${s[0]}-${s[1]} æ¡ï¼Œå…± ${t} æ¡`},onChange:_,scroll:{x:1e3}})})]}),e.jsx(N,{title:w==="approve"?"é€šè¿‡è¯„è®º":"æ‹’ç»è¯„è®º",open:F,onCancel:m,footer:null,width:600,children:p&&e.jsxs(g,{form:r,layout:"vertical",onFinish:u,children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8},children:"è¯„è®ºè¯¦æƒ…ï¼š"}),e.jsxs("div",{style:{padding:12,background:"#f5f5f5",borderRadius:4},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"è¯„è®ºå†…å®¹ï¼š"}),p.content]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"è¯„è®ºè€…ï¼š"}),p.user.nickname," (@",p.user.username,")"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"æ‰€å±åŠ¨æ€ï¼š"}),p.targetType==="post"?"åŠ¨æ€":p.targetType==="image"?"å›¾ç‰‡":p.targetType==="video"?"è§†é¢‘":p.targetType," (ID: ",p.targetId,")"]}),p.parentId&&e.jsxs("div",{children:[e.jsx("strong",{children:"å›å¤å¯¹è±¡ï¼š"}),"è¯„è®ºID ",p.parentId]})]})]}),w==="reject"&&e.jsx(g.Item,{label:"æ‹’ç»åŸå› ",name:"reason",rules:[{required:!0,message:"è¯·å¡«å†™æ‹’ç»åŸå› "},{max:200,message:"åŸå› ä¸èƒ½è¶…è¿‡200ä¸ªå­—ç¬¦"}],children:e.jsx(te,{rows:3,placeholder:"è¯·è¾“å…¥æ‹’ç»åŸå› ",showCount:!0,maxLength:200})}),e.jsx(g.Item,{style:{marginBottom:0,textAlign:"right"},children:e.jsxs(b,{children:[e.jsx(j,{onClick:m,children:"å–æ¶ˆ"}),e.jsx(j,{type:"primary",htmlType:"submit",loading:y,danger:w==="reject",children:w==="approve"?"é€šè¿‡è¯„è®º":"æ‹’ç»è¯„è®º"})]})})]})})]})};export{le as CommentManagement};
