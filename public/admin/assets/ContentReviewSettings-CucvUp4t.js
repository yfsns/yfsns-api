import{i as w,j as e}from"./index-C42INjwk.js";import{r as i}from"./react-vendor-CKx6dMfn.js";import{s as y,S as v,i as k,T as x,h as M,G as E}from"./antd-vendor-DaJANQRB.js";import"./redux-vendor-DakFfX2h.js";const j={async fetchSettings(){return(await w.get("/api/admin/config/content/review")).data},async updateSettings(n){return(await w.put("/api/admin/config/content/review",n)).data}},b=[{module:"content_article",enabled:!1,description:"文章发布需要审核"},{module:"content_post",enabled:!1,description:"动态发布需要审核"},{module:"content_comment",enabled:!1,description:"评论发布需要审核"},{module:"content_topic",enabled:!1,description:"话题发布需要审核"},{module:"user_avatar",enabled:!1,description:"头像上传需要审核"},{module:"user_signature",enabled:!1,description:"个性签名需要审核"}],L={content_article:"文章发布需要审核",content_comment:"评论发布需要审核",content_post:"动态发布需要审核",content_topic:"话题发布需要审核",user_avatar:"头像上传需要审核",user_signature:"个性签名需要审核"},R=()=>{const[n,r]=i.useState(null),[g,u]=i.useState(!1),[f,p]=i.useState(!1),o=i.useCallback(async()=>{u(!0);try{const t=await j.fetchSettings(),a=b.map(d=>{var S;const c=(S=t.module_switches)==null?void 0:S.find(C=>C.module===d.module);let _=(c==null?void 0:c.enabled)??!1;return d.module==="user_signature"&&(_=!1),{...d,enabled:_}}),h={...t,module_switches:a};r(h)}catch(t){y.error(t.message||"获取审核配置失败");const a={group:"content",review_settings:{},module_switches:b,total_modules:b.length};r(a)}finally{u(!1)}},[]),m=i.useCallback(async t=>{p(!0);try{const h={module_switches:t.filter(c=>c.module!=="user_signature")},d=await j.updateSettings(h);return await o(),y.success("内容审核配置已保存"),d}catch(a){throw y.error(a.message||"保存失败，请重试"),a}finally{p(!1)}},[o]);i.useEffect(()=>{o()},[o]);const s=i.useMemo(()=>(n==null?void 0:n.module_switches)||[],[n]),l=i.useCallback(t=>L[t]||`${t} 审核`,[]);return{config:n,moduleSwitches:s,loading:g,saving:f,fetchSettings:o,updateSettings:m,getModuleLabel:l}},B=()=>{const{moduleSwitches:n,loading:r,saving:g,updateSettings:u,getModuleLabel:f}=R(),[p,o]=i.useState(null),m=async(s,l)=>{o(s.module);try{const t=n.map(a=>a.module===s.module?{...a,enabled:l}:a);await u(t)}catch{}finally{o(null)}};return e.jsx("div",{style:{padding:"12px"},children:e.jsx(v,{direction:"vertical",size:24,style:{width:"100%"},children:e.jsxs(k,{children:[e.jsx(x.Paragraph,{type:"secondary",style:{marginBottom:24},children:"可控制不同内容模块在发布后是否需要管理员审核通过才能对外展示。关闭后，内容将立即上线。"}),r?e.jsx("div",{style:{textAlign:"center",padding:"48px 0"},children:e.jsx(M,{size:"large",children:e.jsx("div",{style:{padding:"50px 0"},children:e.jsx("div",{children:"加载配置…"})})})}):e.jsx(v,{direction:"vertical",size:16,style:{width:"100%"},children:n.map(s=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",border:"1px solid #f0f0f0",borderRadius:8,background:"#fafafa"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx(x.Text,{strong:!0,children:f(s.module)}),e.jsx(x.Text,{type:"secondary",style:{fontSize:"12px"},children:s.enabled?"开启后，用户发布的内容将进入审核队列。审核通过后才会对外展示。":"关闭后，用户发布的内容将立即展示，不再进入审核流程。"})]}),e.jsx(E,{checked:s.enabled,checkedChildren:"开启",unCheckedChildren:"关闭",onChange:l=>m(s,l),loading:g||p===s.module})]},s.module))})]})})})};export{B as default};
