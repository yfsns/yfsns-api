import{i as R,j as e}from"./index-C42INjwk.js";import{r as i}from"./react-vendor-CKx6dMfn.js";import{s as b,a3 as D,a4 as w,i as h,a6 as S,r as d,ac as F,Q as G,S as _,T as K,u as k,B as E,ad as P,ae as B,af as I,x as N,A as O,I as Q}from"./antd-vendor-DaJANQRB.js";import"./redux-vendor-DakFfX2h.js";const z={getPendingList:async l=>R.get("/api/admin/avatars/pending",{params:l}),reviewAvatar:async(l,n)=>R.post(`/api/admin/avatars/${l}/review`,n),getStatistics:async()=>R.get("/api/admin/avatars/statistics")},q=()=>{const[l,n]=i.useState(!1),[A,o]=i.useState(null),[C,a]=i.useState([]),[m,y]=i.useState(null),[v,f]=i.useState({total:0,per_page:15,current_page:1,last_page:1}),x=i.useCallback(async t=>{var g,u;n(!0);try{const r=await z.getPendingList(t);a(r.data.data),f(r.data.pagination)}catch(r){b.error(((u=(g=r==null?void 0:r.response)==null?void 0:g.data)==null?void 0:u.message)||"获取待审核头像列表失败"),a([])}finally{n(!1)}},[]),c=i.useCallback(async()=>{try{const t=await z.getStatistics();y(t.data)}catch(t){console.error("获取审核统计失败:",t)}},[]),s=i.useCallback(async(t,g,u)=>{var r,T;o(t);try{const j={action:g,remark:(u==null?void 0:u.trim())||void 0};await z.reviewAvatar(t,j);const M=g==="approve"?"通过":"拒绝";return b.success(`头像审核${M}成功`),a(L=>L.filter($=>$.id!==t)),await c(),!0}catch(j){return b.error(((T=(r=j==null?void 0:j.response)==null?void 0:r.data)==null?void 0:T.message)||"审核失败，请重试"),!1}finally{o(null)}},[c]);return i.useEffect(()=>{x(),c()},[x,c]),{loading:l,reviewing:A,pendingAvatars:C,statistics:m,pagination:v,fetchPendingAvatars:x,fetchStatistics:c,reviewAvatar:s}},{Title:X,Text:p,Paragraph:Y}=K,{TextArea:H}=Q,Z=()=>{const{loading:l,reviewing:n,pendingAvatars:A,statistics:o,reviewAvatar:C}=q(),[a,m]=i.useState({visible:!1,avatar:null,action:"approve"}),[y,v]=i.useState(""),f=(s,t)=>{m({visible:!0,avatar:s,action:t}),v("")},x=()=>{m({visible:!1,avatar:null,action:"approve"}),v("")},c=async()=>{if(!a.avatar)return;await C(a.avatar.id,a.action,y)&&x()};return e.jsxs("div",{style:{padding:"12px"},children:[o&&e.jsxs(D,{gutter:16,style:{marginBottom:"24px"},children:[e.jsx(w,{span:6,children:e.jsx(h,{children:e.jsx(S,{title:"待审核头像",value:o.pending_count,valueStyle:{color:"#faad14"}})})}),e.jsx(w,{span:6,children:e.jsx(h,{children:e.jsx(S,{title:"今日通过",value:o.approved_today,valueStyle:{color:"#52c41a"}})})}),e.jsx(w,{span:6,children:e.jsx(h,{children:e.jsx(S,{title:"今日拒绝",value:o.rejected_today,valueStyle:{color:"#ff4d4f"}})})}),e.jsx(w,{span:6,children:e.jsx(h,{children:e.jsx(S,{title:"已过期",value:o.expired_count,valueStyle:{color:"#d9d9d9"}})})})]}),e.jsx(h,{title:"待审核头像",style:{marginBottom:"24px"},children:e.jsxs(d,{dataSource:A,rowKey:"id",loading:l,pagination:!1,size:"small",scroll:{x:800},locale:{emptyText:e.jsx(I,{description:"暂无待审核头像",image:I.PRESENTED_IMAGE_SIMPLE})},children:[e.jsx(d.Column,{title:"头像",width:100,render:(s,t)=>e.jsx(F,{src:t.avatar_url,alt:"用户头像",style:{width:"60px",height:"60px",borderRadius:"50%",objectFit:"cover"},preview:{mask:e.jsx(G,{})}})},"avatar"),e.jsx(d.Column,{title:"用户信息",width:200,render:(s,t)=>e.jsxs(_,{direction:"vertical",size:2,children:[e.jsx(p,{strong:!0,children:t.user.nickname}),e.jsxs(p,{type:"secondary",style:{fontSize:"12px"},children:["@",t.user.username]})]})},"user"),e.jsx(d.Column,{title:"提交时间",dataIndex:"submitted_at",width:160,render:s=>e.jsx(p,{type:"secondary",style:{fontSize:"12px"},children:s})},"submitted_at"),e.jsx(d.Column,{title:"过期时间",dataIndex:"expires_at",width:160,render:s=>e.jsx(p,{type:"secondary",style:{fontSize:"12px"},children:s})},"expires_at"),e.jsx(d.Column,{title:"审核状态",width:120,render:(s,t)=>e.jsxs(_,{direction:"vertical",size:2,children:[t.review_attempts>0&&e.jsxs(k,{color:"orange",style:{fontSize:"10px"},children:["审核",t.review_attempts,"次"]}),e.jsx(k,{color:"processing",style:{fontSize:"10px"},children:"待审核"})]})},"status"),e.jsx(d.Column,{title:"操作",width:180,fixed:"right",render:(s,t)=>e.jsxs(_,{size:"small",children:[e.jsx(E,{type:"primary",size:"small",icon:e.jsx(P,{}),onClick:()=>f(t,"approve"),loading:n===t.id,children:"通过"}),e.jsx(E,{danger:!0,size:"small",icon:e.jsx(B,{}),onClick:()=>f(t,"reject"),loading:n===t.id,children:"拒绝"})]})},"action")]})}),e.jsxs(N,{title:e.jsxs(_,{children:[a.action==="approve"?e.jsx(P,{style:{color:"#52c41a"}}):e.jsx(B,{style:{color:"#ff4d4f"}}),a.action==="approve"?"通过审核":"拒绝审核"]}),open:a.visible,onOk:c,onCancel:x,okText:a.action==="approve"?"通过":"拒绝",cancelText:"取消",okButtonProps:{type:(a.action==="approve","primary"),danger:a.action==="reject"},confirmLoading:n!==null,children:[a.avatar&&e.jsxs("div",{style:{textAlign:"center",marginBottom:"16px"},children:[e.jsx(O,{src:a.avatar.avatar_url,size:80,style:{marginBottom:"8px"}}),e.jsxs("div",{children:[e.jsx(p,{strong:!0,children:a.avatar.user.nickname}),e.jsx("br",{}),e.jsxs(p,{type:"secondary",children:["@",a.avatar.user.username]})]})]}),e.jsx("div",{style:{marginBottom:"16px"},children:e.jsx(p,{strong:!0,children:"审核备注（可选）："})}),e.jsx(H,{placeholder:"请输入审核备注...",value:y,onChange:s=>v(s.target.value),rows:3,maxLength:500,showCount:!0})]})]})};export{Z as default};
